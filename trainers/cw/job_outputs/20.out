Validation cm: [[740   0   0   0]
 [ 92   0   0   0]
 [ 77   0   0   0]
 [130   0   0   0]]
Validation normalized_cm: [[1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]]
Validation acc: 0.7122232916265641
Validation class_accuracies: [1.0, 0.0, 0.0, 0.0]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.25
Validation one_indexed_epoch: 1
Tensorflow Version: 2.7.1
Num GPUs Available:  1
Collecting Variables...
All variables have been collected.
../cache/
cw
train20
-----------------------
Job id is 1.
- Loading Perch.
3278 Perch audios have been loaded.
- Loading Icbhi.
725 Icbhi audios have been loaded.
- Loading Antwerp.
131 Antwerp audios have been loaded.
- Preparing Perch.
862 Perch groups of audio chunks (by filename or patients) have been prepared.
- Preparing Icbhi.
112 Icbhi groups of audio chunks (by filename or patients) have been prepared.
- Preparing Antwerp.
15 Antwerp groups of audio chunks (by filename or patients) have been prepared.
--- Samples are being split into training/val groups and de-grouped by patient ---
--- Perch training dataset went from 0 to 2649 elements, with 2346 none's, 61 crakles, 186 wheezes and 56 both ---
--- Perch Validation dataset contains 629 elements, with 551 none, 12 crackles, 54 wheezes and 12 both ---
--- Icbhi training dataset went from 0 to 2040 elements, with 707 none's, 720 crakles, 285 wheezes and 327 both ---
--- Icbhi Validation dataset contains 299 elements, with 172 none, 70 crackles, 18 wheezes and 39 both ---
--- Antwerp training dataset went from 0 to 580 elements, with 82 none's, 16 crakles, 448 wheezes and 34 both ---
--- Antwerp Validation dataset contains 111 elements, with 17 none, 10 crackles, 5 wheezes and 79 both ---
-----------------------
--- Final training dataset went from 0 to 5269 elements, with 3135 none's, 797 crakles, 919 wheezes and 417 both ---
--- Final Validation dataset contains 1039 elements, with 740 none, 92 crackles, 77 wheezes and 130 both ---
Model: "leaf_model"
______________________________________________________________________________________________________________
 Layer (type)                                    Output Shape                                Param #          
==============================================================================================================
 leaf (Leaf)                                     multiple                                    560              
                                                                                                              
 sequential (Sequential)                         (None, 128)                                 105694           
                                                                                                              
 dense (Dense)                                   multiple                                    258              
                                                                                                              
==============================================================================================================
Total params: 106,512
Trainable params: 106,016
Non-trainable params: 496
______________________________________________________________________________________________________________
Target metric is avg_accuracy
Epoch 1/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 518s - loss: 0.4434 - accuracy: 0.5866 - 518s/epoch - 2s/step
Validation cm: [[667  61  12   0]
 [ 56  32   3   1]
 [ 58   7   9   3]
 [ 69   8  49   4]]
Validation normalized_cm: [[0.901 0.082 0.016 0.   ]
 [0.609 0.348 0.033 0.011]
 [0.753 0.091 0.117 0.039]
 [0.531 0.062 0.377 0.031]]
Validation acc: 0.685274302213667
Validation class_accuracies: [0.9013513513513514, 0.34782608695652173, 0.11688311688311688, 0.03076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3492074464900552
Validation one_indexed_epoch: 2
Epoch 2/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 507s - loss: 0.3575 - accuracy: 0.6403 - 507s/epoch - 2s/step
Validation cm: [[665  61  12   2]
 [ 51  26   7   8]
 [ 55   4  15   3]
 [ 47   7  64  12]]
Validation normalized_cm: [[0.899 0.082 0.016 0.003]
 [0.554 0.283 0.076 0.087]
 [0.714 0.052 0.195 0.039]
 [0.362 0.054 0.492 0.092]]
Validation acc: 0.6910490856592878
Validation class_accuracies: [0.8986486486486487, 0.2826086956521739, 0.19480519480519481, 0.09230769230769231]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3670925578534274
Validation one_indexed_epoch: 3
Epoch 3/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 506s - loss: 0.3286 - accuracy: 0.6485 - 506s/epoch - 2s/step
Validation cm: [[639  90  10   1]
 [ 36  45   8   3]
 [ 57   3  13   4]
 [ 39  17  57  17]]
Validation normalized_cm: [[0.864 0.122 0.014 0.001]
 [0.391 0.489 0.087 0.033]
 [0.74  0.039 0.169 0.052]
 [0.3   0.131 0.438 0.131]]
Validation acc: 0.687199230028874
Validation class_accuracies: [0.8635135135135135, 0.4891304347826087, 0.16883116883116883, 0.13076923076923078]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4130610869741304
Validation one_indexed_epoch: 4
Epoch 4/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 506s - loss: 0.2971 - accuracy: 0.6392 - 506s/epoch - 2s/step
Validation cm: [[719  16   5   0]
 [ 78   9   5   0]
 [ 71   0   6   0]
 [ 85   1  38   6]]
Validation normalized_cm: [[0.972 0.022 0.007 0.   ]
 [0.848 0.098 0.054 0.   ]
 [0.922 0.    0.078 0.   ]
 [0.654 0.008 0.292 0.046]]
Validation acc: 0.7122232916265641
Validation class_accuracies: [0.9716216216216216, 0.09782608695652174, 0.07792207792207792, 0.046153846153846156]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.29838090816351687
Validation one_indexed_epoch: 5
Epoch 5/17
[[0. 0.]]
The validation tracker metric at 0.4130610869741304 hasn't increased by 0 in 1 epochs
330/330 - 503s - loss: 0.2713 - accuracy: 0.6354 - 503s/epoch - 2s/step
Validation cm: [[560 161   7  12]
 [ 24  56   2  10]
 [ 39   8  16  14]
 [ 24  33  43  30]]
Validation normalized_cm: [[0.757 0.218 0.009 0.016]
 [0.261 0.609 0.022 0.109]
 [0.506 0.104 0.208 0.182]
 [0.185 0.254 0.331 0.231]]
Validation acc: 0.6371511068334937
Validation class_accuracies: [0.7567567567567568, 0.6086956521739131, 0.2077922077922078, 0.23076923076923078]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45100346187302714
Validation one_indexed_epoch: 6
Epoch 6/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 489s - loss: 0.2477 - accuracy: 0.6569 - 489s/epoch - 1s/step
Validation cm: [[630  64  30  16]
 [ 42  27  19   4]
 [ 33   2  31  11]
 [ 21  12  79  18]]
Validation normalized_cm: [[0.851 0.086 0.041 0.022]
 [0.457 0.293 0.207 0.043]
 [0.429 0.026 0.403 0.143]
 [0.162 0.092 0.608 0.138]]
Validation acc: 0.6794995187680462
Validation class_accuracies: [0.8513513513513513, 0.29347826086956524, 0.4025974025974026, 0.13846153846153847]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4214721383199644
Validation one_indexed_epoch: 7
Epoch 7/17
[[0. 0.]]
The validation tracker metric at 0.45100346187302714 hasn't increased by 0 in 1 epochs
330/330 - 491s - loss: 0.2230 - accuracy: 0.6808 - 491s/epoch - 1s/step
Validation cm: [[695  17  19   9]
 [ 64  19   8   1]
 [ 49   1  22   5]
 [ 73  10  32  15]]
Validation normalized_cm: [[0.939 0.023 0.026 0.012]
 [0.696 0.207 0.087 0.011]
 [0.636 0.013 0.286 0.065]
 [0.562 0.077 0.246 0.115]]
Validation acc: 0.7228103946102021
Validation class_accuracies: [0.9391891891891891, 0.20652173913043478, 0.2857142857142857, 0.11538461538461539]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.38670245735463127
Validation one_indexed_epoch: 8
Epoch 8/17
[[0. 0.]]
The validation tracker metric at 0.45100346187302714 hasn't increased by 0 in 2 epochs
330/330 - 490s - loss: 0.1999 - accuracy: 0.6703 - 490s/epoch - 1s/step
Validation cm: [[563 132  28  17]
 [ 19  41  12  20]
 [ 25   4  32  16]
 [ 13  13  48  56]]
Validation normalized_cm: [[0.761 0.178 0.038 0.023]
 [0.207 0.446 0.13  0.217]
 [0.325 0.052 0.416 0.208]
 [0.1   0.1   0.369 0.431]]
Validation acc: 0.6660250240615977
Validation class_accuracies: [0.7608108108108108, 0.44565217391304346, 0.4155844155844156, 0.4307692307692308]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5132041577693751
Validation one_indexed_epoch: 9
Epoch 9/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 491s - loss: 0.1804 - accuracy: 0.6671 - 491s/epoch - 1s/step
Validation cm: [[600  52  68  20]
 [ 36  26  15  15]
 [ 23   2  43   9]
 [ 15   9  83  23]]
Validation normalized_cm: [[0.811 0.07  0.092 0.027]
 [0.391 0.283 0.163 0.163]
 [0.299 0.026 0.558 0.117]
 [0.115 0.069 0.638 0.177]]
Validation acc: 0.6660250240615977
Validation class_accuracies: [0.8108108108108109, 0.2826086956521739, 0.5584415584415584, 0.17692307692307693]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45719603545690507
Validation one_indexed_epoch: 10
Epoch 10/17
[[0. 1.]]
The validation tracker metric at 0.5132041577693751 hasn't increased by 0 in 1 epochs
330/330 - 488s - loss: 0.1553 - accuracy: 0.6802 - 488s/epoch - 1s/step
Validation cm: [[637  86  12   5]
 [ 39  35  12   6]
 [ 42   7  17  11]
 [ 41  13  44  32]]
Validation normalized_cm: [[0.861 0.116 0.016 0.007]
 [0.424 0.38  0.13  0.065]
 [0.545 0.091 0.221 0.143]
 [0.315 0.1   0.338 0.246]]
Validation acc: 0.6939364773820982
Validation class_accuracies: [0.8608108108108108, 0.3804347826086957, 0.22077922077922077, 0.24615384615384617]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.42704466508814337
Validation one_indexed_epoch: 11
Epoch 11/17
[[0. 0.]]
The validation tracker metric at 0.5132041577693751 hasn't increased by 0 in 2 epochs
330/330 - 489s - loss: 0.1356 - accuracy: 0.6707 - 489s/epoch - 1s/step
Validation cm: [[660  47  21  12]
 [ 48  20  15   9]
 [ 42   4  26   5]
 [ 27   9  56  38]]
Validation normalized_cm: [[0.892 0.064 0.028 0.016]
 [0.522 0.217 0.163 0.098]
 [0.545 0.052 0.338 0.065]
 [0.208 0.069 0.431 0.292]]
Validation acc: 0.7160731472569779
Validation class_accuracies: [0.8918918918918919, 0.21739130434782608, 0.33766233766233766, 0.2923076923076923]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.43481330655243705
Validation one_indexed_epoch: 12
Epoch 12/17
[[0. 0.]]
The validation tracker metric at 0.5132041577693751 hasn't increased by 0 in 3 epochs
Lr has been adjusted to 0.0005000000237487257
330/330 - 487s - loss: 0.1202 - accuracy: 0.6614 - 487s/epoch - 1s/step
Validation cm: [[658  45  27  10]
 [ 39  27  11  15]
 [ 35   1  30  11]
 [ 26   8  47  49]]
Validation normalized_cm: [[0.889 0.061 0.036 0.014]
 [0.424 0.293 0.12  0.163]
 [0.455 0.013 0.39  0.143]
 [0.2   0.062 0.362 0.377]]
Validation acc: 0.7353224254090471
Validation class_accuracies: [0.8891891891891892, 0.29347826086956524, 0.38961038961038963, 0.3769230769230769]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.48730022914805526
Validation one_indexed_epoch: 13
Epoch 13/17
[[0. 0.]]
The validation tracker metric at 0.5132041577693751 hasn't increased by 0 in 4 epochs
330/330 - 486s - loss: 0.0745 - accuracy: 0.6472 - 486s/epoch - 1s/step
Validation cm: [[671  53   8   8]
 [ 49  23  11   9]
 [ 45   2  23   7]
 [ 37   7  59  27]]
Validation normalized_cm: [[0.907 0.072 0.011 0.011]
 [0.533 0.25  0.12  0.098]
 [0.584 0.026 0.299 0.091]
 [0.285 0.054 0.454 0.208]]
Validation acc: 0.7160731472569779
Validation class_accuracies: [0.9067567567567567, 0.25, 0.2987012987012987, 0.2076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.41578759078759076
Validation one_indexed_epoch: 14
Epoch 14/17
[[0. 0.]]
The validation tracker metric at 0.5132041577693751 hasn't increased by 0 in 5 epochs
330/330 - 487s - loss: 0.0578 - accuracy: 0.6512 - 487s/epoch - 1s/step
Validation cm: [[646  52  30  12]
 [ 36  28  15  13]
 [ 37   2  26  12]
 [ 26   8  67  29]]
Validation normalized_cm: [[0.873 0.07  0.041 0.016]
 [0.391 0.304 0.163 0.141]
 [0.481 0.026 0.338 0.156]
 [0.2   0.062 0.515 0.223]]
Validation acc: 0.7016361886429259
Validation class_accuracies: [0.8729729729729729, 0.30434782608695654, 0.33766233766233766, 0.2230769230769231]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4345150149497976
Validation one_indexed_epoch: 15
Epoch 15/17
[[0. 0.]]
The number of epochs since last 1% equals the patience
Lr has been adjusted to 0.0002500000118743628
330/330 - 485s - loss: 0.0546 - accuracy: 0.6464 - 485s/epoch - 1s/step
----------------------------------
The best metrics for this job are: 

Best avg_accuracy: 0.5132041577693751
Best cm: [[563 132  28  17]
 [ 19  41  12  20]
 [ 25   4  32  16]
 [ 13  13  48  56]]
Best normalized_cm: [[0.761 0.178 0.038 0.023]
 [0.207 0.446 0.13  0.217]
 [0.325 0.052 0.416 0.208]
 [0.1   0.1   0.369 0.431]]
Best acc: 0.6660250240615977
Best class_accuracies: [0.7608108108108108, 0.44565217391304346, 0.4155844155844156, 0.4307692307692308]
Best precision: None
Best recall: None
Best f1: None
Best roc_auc: None
Best one_indexed_epoch: 9
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/keras/optimizer_v2/adam.py:105: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  super(Adam, self).__init__(name, **kwargs)
/home/alirachidi/classification_algorithm/trainers/modules/main/global_helpers.py:48: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  plt.show()
avg_accuracy
model
cm
normalized_cm
acc
class_accuracies
precision
recall
f1
roc_auc
one_indexed_epoch
