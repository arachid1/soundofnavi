Validation cm: [[740   0   0   0]
 [ 92   0   0   0]
 [ 77   0   0   0]
 [130   0   0   0]]
Validation normalized_cm: [[1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]]
Validation acc: 0.7122232916265641
Validation class_accuracies: [1.0, 0.0, 0.0, 0.0]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.25
Validation one_indexed_epoch: 1
Tensorflow Version: 2.7.1
Num GPUs Available:  1
Collecting Variables...
All variables have been collected.
../cache/
cw
train31
-----------------------
Job id is 1.
- Loading Perch.
3278 Perch audios have been loaded.
- Loading Icbhi.
725 Icbhi audios have been loaded.
- Loading Antwerp.
131 Antwerp audios have been loaded.
- Preparing Perch.
862 Perch groups of audio chunks (by filename or patients) have been prepared.
- Preparing Icbhi.
112 Icbhi groups of audio chunks (by filename or patients) have been prepared.
- Preparing Antwerp.
15 Antwerp groups of audio chunks (by filename or patients) have been prepared.
--- Samples are being split into training/val groups and de-grouped by patient ---
--- Perch training dataset went from 0 to 2649 elements, with 2346 none's, 61 crakles, 186 wheezes and 56 both ---
--- Perch Validation dataset contains 629 elements, with 551 none, 12 crackles, 54 wheezes and 12 both ---
--- Icbhi training dataset went from 0 to 2040 elements, with 707 none's, 720 crakles, 285 wheezes and 327 both ---
--- Icbhi Validation dataset contains 299 elements, with 172 none, 70 crackles, 18 wheezes and 39 both ---
--- Antwerp training dataset went from 0 to 580 elements, with 82 none's, 16 crakles, 448 wheezes and 34 both ---
--- Antwerp Validation dataset contains 111 elements, with 17 none, 10 crackles, 5 wheezes and 79 both ---
-----------------------
--- Final training dataset went from 0 to 5269 elements, with 3135 none's, 797 crakles, 919 wheezes and 417 both ---
--- Final Validation dataset contains 1039 elements, with 740 none, 92 crackles, 77 wheezes and 130 both ---
Model: "leaf_model9_model"
______________________________________________________________________________________________________________
 Layer (type)                                    Output Shape                                Param #          
==============================================================================================================
 leaf (Leaf)                                     multiple                                    560              
                                                                                                              
 batch_normalization (BatchNormalization)        multiple                                    4                
                                                                                                              
 sequential (Sequential)                         (None, 80, 500, 16)                         2352             
                                                                                                              
 sequential_1 (Sequential)                       (None, 80, 500, 16)                         6448             
                                                                                                              
 sequential_2 (Sequential)                       (None, 80, 500, 16)                         32               
                                                                                                              
 concatenate (Concatenate)                       multiple                                    0                
                                                                                                              
 sequential_3 (Sequential)                       (None, 512)                                 6191296          
                                                                                                              
 dense (Dense)                                   multiple                                    1026             
                                                                                                              
==============================================================================================================
Total params: 6,201,718
Trainable params: 6,160,212
Non-trainable params: 41,506
______________________________________________________________________________________________________________
Target metric is avg_accuracy
Epoch 1/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 668s - loss: 0.5012 - accuracy: 0.5648 - 668s/epoch - 2s/step
Validation cm: [[698  13  29   0]
 [ 75   3  14   0]
 [ 43   1  31   2]
 [ 49   3  72   6]]
Validation normalized_cm: [[0.943 0.018 0.039 0.   ]
 [0.815 0.033 0.152 0.   ]
 [0.558 0.013 0.403 0.026]
 [0.377 0.023 0.554 0.046]]
Validation acc: 0.710298363811357
Validation class_accuracies: [0.9432432432432433, 0.03260869565217391, 0.4025974025974026, 0.046153846153846156]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3561507969116665
Validation one_indexed_epoch: 2
Epoch 2/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 654s - loss: 0.4051 - accuracy: 0.5741 - 654s/epoch - 2s/step
Validation cm: [[464 105 169   2]
 [ 28  50  10   4]
 [ 24   3  32  18]
 [ 15  17  35  63]]
Validation normalized_cm: [[0.627 0.142 0.228 0.003]
 [0.304 0.543 0.109 0.043]
 [0.312 0.039 0.416 0.234]
 [0.115 0.131 0.269 0.485]]
Validation acc: 0.5861405197305101
Validation class_accuracies: [0.6270270270270271, 0.5434782608695652, 0.4155844155844156, 0.4846153846153846]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5176762720240982
Validation one_indexed_epoch: 3
Epoch 3/20
[[0. 1.]]
-- New best results were achieved. --
Saving model...
330/330 - 656s - loss: 0.3761 - accuracy: 0.6273 - 656s/epoch - 2s/step
Validation cm: [[486 234  19   1]
 [ 19  61  11   1]
 [ 46  19   6   6]
 [ 13  36  67  14]]
Validation normalized_cm: [[0.657 0.316 0.026 0.001]
 [0.207 0.663 0.12  0.011]
 [0.597 0.247 0.078 0.078]
 [0.1   0.277 0.515 0.108]]
Validation acc: 0.5457170356111646
Validation class_accuracies: [0.6567567567567567, 0.6630434782608695, 0.07792207792207792, 0.1076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.37635365515800295
Validation one_indexed_epoch: 4
Epoch 4/20
[[0. 0.]]
The validation tracker metric at 0.5176762720240982 hasn't increased by 0 in 1 epochs
330/330 - 654s - loss: 0.3600 - accuracy: 0.5910 - 654s/epoch - 2s/step
Validation cm: [[596 101  32  11]
 [ 24  39  23   6]
 [ 33   9  22  13]
 [ 16   7  73  34]]
Validation normalized_cm: [[0.805 0.136 0.043 0.015]
 [0.261 0.424 0.25  0.065]
 [0.429 0.117 0.286 0.169]
 [0.123 0.054 0.562 0.262]]
Validation acc: 0.6650625601539942
Validation class_accuracies: [0.8054054054054054, 0.42391304347826086, 0.2857142857142857, 0.26153846153846155]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.44414279903410336
Validation one_indexed_epoch: 5
Epoch 5/20
[[0. 0.]]
The validation tracker metric at 0.5176762720240982 hasn't increased by 0 in 2 epochs
330/330 - 655s - loss: 0.3481 - accuracy: 0.5921 - 655s/epoch - 2s/step
Validation cm: [[628  59  50   3]
 [ 46  32  14   0]
 [ 45   1  29   2]
 [ 39   8  62  21]]
Validation normalized_cm: [[0.849 0.08  0.068 0.004]
 [0.5   0.348 0.152 0.   ]
 [0.584 0.013 0.377 0.026]
 [0.3   0.062 0.477 0.162]]
Validation acc: 0.6833493743984601
Validation class_accuracies: [0.8486486486486486, 0.34782608695652173, 0.37662337662337664, 0.16153846153846155]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.43365914344175216
Validation one_indexed_epoch: 6
Epoch 6/20
[[0. 0.]]
The validation tracker metric at 0.5176762720240982 hasn't increased by 0 in 3 epochs
330/330 - 650s - loss: 0.3331 - accuracy: 0.6246 - 650s/epoch - 2s/step
Validation cm: [[580 113  38   9]
 [ 21  59   9   3]
 [ 22   6  40   9]
 [ 13  18  73  26]]
Validation normalized_cm: [[0.784 0.153 0.051 0.012]
 [0.228 0.641 0.098 0.033]
 [0.286 0.078 0.519 0.117]
 [0.1   0.138 0.562 0.2  ]]
Validation acc: 0.6785370548604427
Validation class_accuracies: [0.7837837837837838, 0.6413043478260869, 0.5194805194805194, 0.2]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5361421627725975
Validation one_indexed_epoch: 7
Epoch 7/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 648s - loss: 0.3169 - accuracy: 0.6432 - 648s/epoch - 2s/step
Validation cm: [[590 124  11  15]
 [ 13  58   2  19]
 [ 35  10   8  24]
 [ 15  20  13  82]]
Validation normalized_cm: [[0.797 0.168 0.015 0.02 ]
 [0.141 0.63  0.022 0.207]
 [0.455 0.13  0.104 0.312]
 [0.115 0.154 0.1   0.631]]
Validation acc: 0.710298363811357
Validation class_accuracies: [0.7972972972972973, 0.6304347826086957, 0.1038961038961039, 0.6307692307692307]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.540599353642832
Validation one_indexed_epoch: 8
Epoch 8/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 650s - loss: 0.3020 - accuracy: 0.6430 - 650s/epoch - 2s/step
Validation cm: [[613  63  50  14]
 [ 35  25  25   7]
 [ 32   1  42   2]
 [ 13   6  89  22]]
Validation normalized_cm: [[0.828 0.085 0.068 0.019]
 [0.38  0.272 0.272 0.076]
 [0.416 0.013 0.545 0.026]
 [0.1   0.046 0.685 0.169]]
Validation acc: 0.6756496631376323
Validation class_accuracies: [0.8283783783783784, 0.2717391304347826, 0.5454545454545454, 0.16923076923076924]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4537007058746189
Validation one_indexed_epoch: 9
Epoch 9/20
[[0. 0.]]
The validation tracker metric at 0.540599353642832 hasn't increased by 0 in 1 epochs
330/330 - 653s - loss: 0.2942 - accuracy: 0.6140 - 653s/epoch - 2s/step
Validation cm: [[706   7  25   2]
 [ 84   4   3   1]
 [ 34   0  34   9]
 [ 39   2  73  16]]
Validation normalized_cm: [[0.954 0.009 0.034 0.003]
 [0.913 0.043 0.033 0.011]
 [0.442 0.    0.442 0.117]
 [0.3   0.015 0.562 0.123]]
Validation acc: 0.7314725697786333
Validation class_accuracies: [0.9540540540540541, 0.043478260869565216, 0.44155844155844154, 0.12307692307692308]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.39054191988974596
Validation one_indexed_epoch: 10
Epoch 10/20
[[0. 0.]]
The validation tracker metric at 0.540599353642832 hasn't increased by 0 in 2 epochs
330/330 - 654s - loss: 0.2757 - accuracy: 0.6422 - 654s/epoch - 2s/step
Validation cm: [[628  85  19   8]
 [ 32  42  15   3]
 [ 34   8  24  11]
 [ 15  20  68  27]]
Validation normalized_cm: [[0.849 0.115 0.026 0.011]
 [0.348 0.457 0.163 0.033]
 [0.442 0.104 0.312 0.143]
 [0.115 0.154 0.523 0.208]]
Validation acc: 0.6939364773820982
Validation class_accuracies: [0.8486486486486486, 0.45652173913043476, 0.3116883116883117, 0.2076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4561377517899257
Validation one_indexed_epoch: 11
Epoch 11/20
[[0. 0.]]
The validation tracker metric at 0.540599353642832 hasn't increased by 0 in 3 epochs
330/330 - 652s - loss: 0.2723 - accuracy: 0.6403 - 652s/epoch - 2s/step
Validation cm: [[613  93  15  19]
 [ 26  47   2  17]
 [ 45   6  15  11]
 [ 25  50  15  40]]
Validation normalized_cm: [[0.828 0.126 0.02  0.026]
 [0.283 0.511 0.022 0.185]
 [0.584 0.078 0.195 0.143]
 [0.192 0.385 0.115 0.308]]
Validation acc: 0.6881616939364774
Validation class_accuracies: [0.8283783783783784, 0.5108695652173914, 0.19480519480519481, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.46043636152331807
Validation one_indexed_epoch: 12
Epoch 12/20
[[0. 0.]]
The validation tracker metric at 0.540599353642832 hasn't increased by 0 in 4 epochs
330/330 - 653s - loss: 0.2603 - accuracy: 0.6358 - 653s/epoch - 2s/step
Validation cm: [[534 143  40  23]
 [ 17  53   5  17]
 [ 17  13  27  20]
 [  5  28  39  58]]
Validation normalized_cm: [[0.722 0.193 0.054 0.031]
 [0.185 0.576 0.054 0.185]
 [0.221 0.169 0.351 0.26 ]
 [0.038 0.215 0.3   0.446]]
Validation acc: 0.6467757459095284
Validation class_accuracies: [0.7216216216216216, 0.5760869565217391, 0.35064935064935066, 0.4461538461538462]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5236279437366395
Validation one_indexed_epoch: 13
Epoch 13/20
[[0. 1.]]
The validation tracker metric at 0.540599353642832 hasn't increased by 0 in 5 epochs
330/330 - 650s - loss: 0.2444 - accuracy: 0.6542 - 650s/epoch - 2s/step
Validation cm: [[661  47  28   4]
 [ 52  21  16   3]
 [ 26   3  43   5]
 [ 27   7  64  32]]
Validation normalized_cm: [[0.893 0.064 0.038 0.005]
 [0.565 0.228 0.174 0.033]
 [0.338 0.039 0.558 0.065]
 [0.208 0.054 0.492 0.246]]
Validation acc: 0.7285851780558229
Validation class_accuracies: [0.8932432432432432, 0.22826086956521738, 0.5584415584415584, 0.24615384615384617]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.48152487935096633
Validation one_indexed_epoch: 14
Epoch 14/20
[[0. 0.]]
The number of epochs since last 1% equals the patience
330/330 - 653s - loss: 0.2357 - accuracy: 0.6238 - 653s/epoch - 2s/step
----------------------------------
The best metrics for this job are: 

Best avg_accuracy: 0.540599353642832
Best cm: [[590 124  11  15]
 [ 13  58   2  19]
 [ 35  10   8  24]
 [ 15  20  13  82]]
Best normalized_cm: [[0.797 0.168 0.015 0.02 ]
 [0.141 0.63  0.022 0.207]
 [0.455 0.13  0.104 0.312]
 [0.115 0.154 0.1   0.631]]
Best acc: 0.710298363811357
Best class_accuracies: [0.7972972972972973, 0.6304347826086957, 0.1038961038961039, 0.6307692307692307]
Best precision: None
Best recall: None
Best f1: None
Best roc_auc: None
Best one_indexed_epoch: 8
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/keras/optimizer_v2/adam.py:105: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  super(Adam, self).__init__(name, **kwargs)
/home/alirachidi/classification_algorithm/trainers/modules/main/global_helpers.py:48: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  plt.show()
avg_accuracy
model
cm
normalized_cm
acc
class_accuracies
precision
recall
f1
roc_auc
one_indexed_epoch
