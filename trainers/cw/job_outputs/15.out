Validation cm: [[740   0   0   0]
 [ 92   0   0   0]
 [ 77   0   0   0]
 [130   0   0   0]]
Validation normalized_cm: [[1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]]
Validation acc: 0.7122232916265641
Validation class_accuracies: [1.0, 0.0, 0.0, 0.0]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.25
Validation one_indexed_epoch: 1
Tensorflow Version: 2.7.1
Num GPUs Available:  1
Collecting Variables...
All variables have been collected.
../cache/
cw
train15
-----------------------
Job id is 1.
- Loading Perch.
3278 Perch audios have been loaded.
- Loading Icbhi.
725 Icbhi audios have been loaded.
- Loading Antwerp.
131 Antwerp audios have been loaded.
- Preparing Perch.
862 Perch groups of audio chunks (by filename or patients) have been prepared.
- Preparing Icbhi.
112 Icbhi groups of audio chunks (by filename or patients) have been prepared.
- Preparing Antwerp.
15 Antwerp groups of audio chunks (by filename or patients) have been prepared.
--- Samples are being split into training/val groups and de-grouped by patient ---
--- Perch training dataset went from 0 to 2649 elements, with 2346 none's, 61 crakles, 186 wheezes and 56 both ---
--- Perch Validation dataset contains 629 elements, with 551 none, 12 crackles, 54 wheezes and 12 both ---
--- Icbhi training dataset went from 0 to 2040 elements, with 707 none's, 720 crakles, 285 wheezes and 327 both ---
--- Icbhi Validation dataset contains 299 elements, with 172 none, 70 crackles, 18 wheezes and 39 both ---
--- Antwerp training dataset went from 0 to 580 elements, with 82 none's, 16 crakles, 448 wheezes and 34 both ---
--- Antwerp Validation dataset contains 111 elements, with 17 none, 10 crackles, 5 wheezes and 79 both ---
-----------------------
--- Final training dataset went from 0 to 5269 elements, with 3135 none's, 797 crakles, 919 wheezes and 417 both ---
--- Final Validation dataset contains 1039 elements, with 740 none, 92 crackles, 77 wheezes and 130 both ---
Model: "leaf_model"
______________________________________________________________________________________________________________
 Layer (type)                                    Output Shape                                Param #          
==============================================================================================================
 leaf (Leaf)                                     multiple                                    280              
                                                                                                              
 sequential (Sequential)                         (None, 128)                                 105694           
                                                                                                              
 dense (Dense)                                   multiple                                    258              
                                                                                                              
==============================================================================================================
Total params: 106,232
Trainable params: 105,736
Non-trainable params: 496
______________________________________________________________________________________________________________
Target metric is avg_accuracy
Epoch 1/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 769s - loss: 0.4555 - accuracy: 0.5735 - 769s/epoch - 2s/step
Validation cm: [[517  81 105  37]
 [ 32  30  11  19]
 [ 14   2  32  29]
 [ 25   5  53  47]]
Validation normalized_cm: [[0.699 0.109 0.142 0.05 ]
 [0.348 0.326 0.12  0.207]
 [0.182 0.026 0.416 0.377]
 [0.192 0.038 0.408 0.362]]
Validation acc: 0.602502406159769
Validation class_accuracies: [0.6986486486486486, 0.32608695652173914, 0.4155844155844156, 0.36153846153846153]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45046462057331627
Validation one_indexed_epoch: 2
Epoch 2/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 762s - loss: 0.3731 - accuracy: 0.6123 - 762s/epoch - 2s/step
Validation cm: [[709  27   4   0]
 [ 77  14   0   1]
 [ 53   2  20   2]
 [ 72   2  55   1]]
Validation normalized_cm: [[0.958 0.036 0.005 0.   ]
 [0.837 0.152 0.    0.011]
 [0.688 0.026 0.26  0.026]
 [0.554 0.015 0.423 0.008]]
Validation acc: 0.7160731472569779
Validation class_accuracies: [0.9581081081081081, 0.15217391304347827, 0.2597402597402597, 0.007692307692307693]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3444286471460385
Validation one_indexed_epoch: 3
Epoch 3/17
[[0. 0.]]
The validation tracker metric at 0.45046462057331627 hasn't increased by 0 in 1 epochs
330/330 - 757s - loss: 0.3415 - accuracy: 0.6362 - 757s/epoch - 2s/step
Validation cm: [[680  59   1   0]
 [ 57  35   0   0]
 [ 60   4  12   1]
 [ 84   2  44   0]]
Validation normalized_cm: [[0.919 0.08  0.001 0.   ]
 [0.62  0.38  0.    0.   ]
 [0.779 0.052 0.156 0.013]
 [0.646 0.015 0.338 0.   ]]
Validation acc: 0.699711260827719
Validation class_accuracies: [0.918918918918919, 0.3804347826086957, 0.15584415584415584, 0.0]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.36379946434294264
Validation one_indexed_epoch: 4
Epoch 4/17
[[0. 0.]]
The validation tracker metric at 0.45046462057331627 hasn't increased by 0 in 2 epochs
330/330 - 763s - loss: 0.3116 - accuracy: 0.6457 - 763s/epoch - 2s/step
Validation cm: [[685  28  11  16]
 [ 56  18   6  12]
 [ 43   0  31   3]
 [ 58   1  58  13]]
Validation normalized_cm: [[0.926 0.038 0.015 0.022]
 [0.609 0.196 0.065 0.13 ]
 [0.558 0.    0.403 0.039]
 [0.446 0.008 0.446 0.1  ]]
Validation acc: 0.7189605389797883
Validation class_accuracies: [0.9256756756756757, 0.1956521739130435, 0.4025974025974026, 0.1]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.40598131304653046
Validation one_indexed_epoch: 5
Epoch 5/17
[[0. 0.]]
The validation tracker metric at 0.45046462057331627 hasn't increased by 0 in 3 epochs
Lr has been adjusted to 0.0005000000237487257
330/330 - 768s - loss: 0.2839 - accuracy: 0.6301 - 768s/epoch - 2s/step
Validation cm: [[682  50   3   5]
 [ 52  27   3  10]
 [ 51   1  19   6]
 [ 60   9  48  13]]
Validation normalized_cm: [[0.922 0.068 0.004 0.007]
 [0.565 0.293 0.033 0.109]
 [0.662 0.013 0.247 0.078]
 [0.462 0.069 0.369 0.1  ]]
Validation acc: 0.7131857555341675
Validation class_accuracies: [0.9216216216216216, 0.29347826086956524, 0.24675324675324675, 0.1]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.39046328231110844
Validation one_indexed_epoch: 6
Epoch 6/17
[[0. 0.]]
The validation tracker metric at 0.45046462057331627 hasn't increased by 0 in 4 epochs
330/330 - 767s - loss: 0.2340 - accuracy: 0.6345 - 767s/epoch - 2s/step
Validation cm: [[619  92  16  13]
 [ 36  44   2  10]
 [ 36   4  29   8]
 [ 40  18  43  29]]
Validation normalized_cm: [[0.836 0.124 0.022 0.018]
 [0.391 0.478 0.022 0.109]
 [0.468 0.052 0.377 0.104]
 [0.308 0.138 0.331 0.223]]
Validation acc: 0.6939364773820982
Validation class_accuracies: [0.8364864864864865, 0.4782608695652174, 0.37662337662337664, 0.2230769230769231]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4786119139380009
Validation one_indexed_epoch: 7
Epoch 7/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 770s - loss: 0.2117 - accuracy: 0.6517 - 770s/epoch - 2s/step
Validation cm: [[591  85  40  24]
 [ 32  42   6  12]
 [ 14   3  44  16]
 [ 12   9  50  59]]
Validation normalized_cm: [[0.799 0.115 0.054 0.032]
 [0.348 0.457 0.065 0.13 ]
 [0.182 0.039 0.571 0.208]
 [0.092 0.069 0.385 0.454]]
Validation acc: 0.7083734359961501
Validation class_accuracies: [0.7986486486486486, 0.45652173913043476, 0.5714285714285714, 0.45384615384615384]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5701112782634522
Validation one_indexed_epoch: 8
Epoch 8/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 771s - loss: 0.1869 - accuracy: 0.6552 - 771s/epoch - 2s/step
Validation cm: [[595 110  24  11]
 [ 32  37   8  15]
 [ 21   3  39  14]
 [ 17   8  52  53]]
Validation normalized_cm: [[0.804 0.149 0.032 0.015]
 [0.348 0.402 0.087 0.163]
 [0.273 0.039 0.506 0.182]
 [0.131 0.062 0.4   0.408]]
Validation acc: 0.6968238691049086
Validation class_accuracies: [0.8040540540540541, 0.40217391304347827, 0.5064935064935064, 0.4076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5301034453208366
Validation one_indexed_epoch: 9
Epoch 9/17
[[0. 0.]]
The validation tracker metric at 0.5701112782634522 hasn't increased by 0 in 1 epochs
330/330 - 767s - loss: 0.1640 - accuracy: 0.6402 - 767s/epoch - 2s/step
Validation cm: [[683  35  19   3]
 [ 58  22   6   6]
 [ 28   0  44   5]
 [ 43   5  66  16]]
Validation normalized_cm: [[0.923 0.047 0.026 0.004]
 [0.63  0.239 0.065 0.065]
 [0.364 0.    0.571 0.065]
 [0.331 0.038 0.508 0.123]]
Validation acc: 0.7362848893166506
Validation class_accuracies: [0.922972972972973, 0.2391304347826087, 0.5714285714285714, 0.12307692307692308]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.464152225565269
Validation one_indexed_epoch: 10
Epoch 10/17
[[0. 0.]]
The validation tracker metric at 0.5701112782634522 hasn't increased by 0 in 2 epochs
330/330 - 765s - loss: 0.1426 - accuracy: 0.6493 - 765s/epoch - 2s/step
Validation cm: [[633  80  16  11]
 [ 38  30  10  14]
 [ 41   3  25   8]
 [ 16  10  64  40]]
Validation normalized_cm: [[0.855 0.108 0.022 0.015]
 [0.413 0.326 0.109 0.152]
 [0.532 0.039 0.325 0.104]
 [0.123 0.077 0.492 0.308]]
Validation acc: 0.7006737247353224
Validation class_accuracies: [0.8554054054054054, 0.32608695652173914, 0.3246753246753247, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45346499857369427
Validation one_indexed_epoch: 11
Epoch 11/17
[[0. 0.]]
The validation tracker metric at 0.5701112782634522 hasn't increased by 0 in 3 epochs
Lr has been adjusted to 0.0002500000118743628
330/330 - 762s - loss: 0.1290 - accuracy: 0.6533 - 762s/epoch - 2s/step
Validation cm: [[642  67  17  14]
 [ 44  30   8  10]
 [ 25   4  38  10]
 [ 28   7  58  37]]
Validation normalized_cm: [[0.868 0.091 0.023 0.019]
 [0.478 0.326 0.087 0.109]
 [0.325 0.052 0.494 0.13 ]
 [0.215 0.054 0.446 0.285]]
Validation acc: 0.7189605389797883
Validation class_accuracies: [0.8675675675675676, 0.32608695652173914, 0.4935064935064935, 0.2846153846153846]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.49294410055279614
Validation one_indexed_epoch: 12
Epoch 12/17
[[0. 0.]]
The validation tracker metric at 0.5701112782634522 hasn't increased by 0 in 4 epochs
330/330 - 762s - loss: 0.0981 - accuracy: 0.6521 - 762s/epoch - 2s/step
Validation cm: [[656  42  32  10]
 [ 53  14  12  13]
 [ 19   2  48   8]
 [ 25   2  63  40]]
Validation normalized_cm: [[0.886 0.057 0.043 0.014]
 [0.576 0.152 0.13  0.141]
 [0.247 0.026 0.623 0.104]
 [0.192 0.015 0.485 0.308]]
Validation acc: 0.7295476419634264
Validation class_accuracies: [0.8864864864864865, 0.15217391304347827, 0.6233766233766234, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.49243233264972397
Validation one_indexed_epoch: 13
Epoch 13/17
[[0. 0.]]
The validation tracker metric at 0.5701112782634522 hasn't increased by 0 in 5 epochs
330/330 - 764s - loss: 0.0811 - accuracy: 0.6400 - 764s/epoch - 2s/step
Validation cm: [[655  64  14   7]
 [ 53  27   7   5]
 [ 30   1  39   7]
 [ 29  12  52  37]]
Validation normalized_cm: [[0.885 0.086 0.019 0.009]
 [0.576 0.293 0.076 0.054]
 [0.39  0.013 0.506 0.091]
 [0.223 0.092 0.4   0.285]]
Validation acc: 0.7295476419634264
Validation class_accuracies: [0.8851351351351351, 0.29347826086956524, 0.5064935064935064, 0.2846153846153846]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4924305717783978
Validation one_indexed_epoch: 14
Epoch 14/17
[[0. 0.]]
The number of epochs since last 1% equals the patience
Lr has been adjusted to 0.0001250000059371814
330/330 - 679s - loss: 0.0732 - accuracy: 0.6386 - 679s/epoch - 2s/step
----------------------------------
The best metrics for this job are: 

Best avg_accuracy: 0.5701112782634522
Best cm: [[591  85  40  24]
 [ 32  42   6  12]
 [ 14   3  44  16]
 [ 12   9  50  59]]
Best normalized_cm: [[0.799 0.115 0.054 0.032]
 [0.348 0.457 0.065 0.13 ]
 [0.182 0.039 0.571 0.208]
 [0.092 0.069 0.385 0.454]]
Best acc: 0.7083734359961501
Best class_accuracies: [0.7986486486486486, 0.45652173913043476, 0.5714285714285714, 0.45384615384615384]
Best precision: None
Best recall: None
Best f1: None
Best roc_auc: None
Best one_indexed_epoch: 8
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/keras/optimizer_v2/adam.py:105: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  super(Adam, self).__init__(name, **kwargs)
/home/alirachidi/classification_algorithm/trainers/modules/main/global_helpers.py:48: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  plt.show()
avg_accuracy
model
cm
normalized_cm
acc
class_accuracies
precision
recall
f1
roc_auc
one_indexed_epoch
