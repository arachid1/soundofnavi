Validation cm: [[740   0   0   0]
 [ 92   0   0   0]
 [ 77   0   0   0]
 [130   0   0   0]]
Validation normalized_cm: [[1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]]
Validation acc: 0.7122232916265641
Validation class_accuracies: [1.0, 0.0, 0.0, 0.0]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.25
Validation one_indexed_epoch: 1
Tensorflow Version: 2.7.1
Num GPUs Available:  1
Collecting Variables...
All variables have been collected.
../cache/
cw
train23
-----------------------
Job id is 1.
- Loading Perch.
3278 Perch audios have been loaded.
- Loading Icbhi.
725 Icbhi audios have been loaded.
- Loading Antwerp.
131 Antwerp audios have been loaded.
- Preparing Perch.
862 Perch groups of audio chunks (by filename or patients) have been prepared.
- Preparing Icbhi.
112 Icbhi groups of audio chunks (by filename or patients) have been prepared.
- Preparing Antwerp.
15 Antwerp groups of audio chunks (by filename or patients) have been prepared.
--- Samples are being split into training/val groups and de-grouped by patient ---
--- Perch training dataset went from 0 to 2649 elements, with 2346 none's, 61 crakles, 186 wheezes and 56 both ---
--- Perch Validation dataset contains 629 elements, with 551 none, 12 crackles, 54 wheezes and 12 both ---
--- Icbhi training dataset went from 0 to 2040 elements, with 707 none's, 720 crakles, 285 wheezes and 327 both ---
--- Icbhi Validation dataset contains 299 elements, with 172 none, 70 crackles, 18 wheezes and 39 both ---
--- Antwerp training dataset went from 0 to 580 elements, with 82 none's, 16 crakles, 448 wheezes and 34 both ---
--- Antwerp Validation dataset contains 111 elements, with 17 none, 10 crackles, 5 wheezes and 79 both ---
-----------------------
--- Final training dataset went from 0 to 5269 elements, with 3135 none's, 797 crakles, 919 wheezes and 417 both ---
--- Final Validation dataset contains 1039 elements, with 740 none, 92 crackles, 77 wheezes and 130 both ---
Model: "leaf_model"
______________________________________________________________________________________________________________
 Layer (type)                                    Output Shape                                Param #          
==============================================================================================================
 mel_filterbanks (MelFilterbanks)                multiple                                    0                
                                                                                                              
 sequential (Sequential)                         (None, 128)                                 105694           
                                                                                                              
 dense (Dense)                                   multiple                                    258              
                                                                                                              
==============================================================================================================
Total params: 105,952
Trainable params: 105,456
Non-trainable params: 496
______________________________________________________________________________________________________________
Target metric is avg_accuracy
Epoch 1/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 116s - loss: 0.4235 - accuracy: 0.5654 - 116s/epoch - 350ms/step
Validation cm: [[735   1   4   0]
 [ 90   0   2   0]
 [ 68   2   6   1]
 [ 87   0  41   2]]
Validation normalized_cm: [[0.993 0.001 0.005 0.   ]
 [0.978 0.    0.022 0.   ]
 [0.883 0.026 0.078 0.013]
 [0.669 0.    0.315 0.015]]
Validation acc: 0.7151106833493744
Validation class_accuracies: [0.9932432432432432, 0.0, 0.07792207792207792, 0.015384615384615385]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.2716374841374841
Validation one_indexed_epoch: 2
Epoch 2/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 112s - loss: 0.3380 - accuracy: 0.5967 - 112s/epoch - 338ms/step
Validation cm: [[623  81  25  11]
 [ 42  36  11   3]
 [ 30   7  32   8]
 [ 26   6  78  20]]
Validation normalized_cm: [[0.842 0.109 0.034 0.015]
 [0.457 0.391 0.12  0.033]
 [0.39  0.091 0.416 0.104]
 [0.2   0.046 0.6   0.154]]
Validation acc: 0.6843118383060636
Validation class_accuracies: [0.8418918918918918, 0.391304347826087, 0.4155844155844156, 0.15384615384615385]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45065670228713706
Validation one_indexed_epoch: 3
Epoch 3/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 110s - loss: 0.2997 - accuracy: 0.6229 - 110s/epoch - 333ms/step
Validation cm: [[462 138  96  44]
 [ 15  55   1  21]
 [ 16   3  23  35]
 [ 12  11  19  88]]
Validation normalized_cm: [[0.624 0.186 0.13  0.059]
 [0.163 0.598 0.011 0.228]
 [0.208 0.039 0.299 0.455]
 [0.092 0.085 0.146 0.677]]
Validation acc: 0.6044273339749759
Validation class_accuracies: [0.6243243243243243, 0.5978260869565217, 0.2987012987012987, 0.676923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5494436967263054
Validation one_indexed_epoch: 4
Epoch 4/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 112s - loss: 0.2690 - accuracy: 0.6449 - 112s/epoch - 339ms/step
Validation cm: [[602  79  39  20]
 [ 36  39  10   7]
 [ 32   2  24  19]
 [ 40  23  52  15]]
Validation normalized_cm: [[0.814 0.107 0.053 0.027]
 [0.391 0.424 0.109 0.076]
 [0.416 0.026 0.312 0.247]
 [0.308 0.177 0.4   0.115]]
Validation acc: 0.6544754571703562
Validation class_accuracies: [0.8135135135135135, 0.42391304347826086, 0.3116883116883117, 0.11538461538461539]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.41612487101617535
Validation one_indexed_epoch: 5
Epoch 5/17
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 1 epochs
330/330 - 112s - loss: 0.2409 - accuracy: 0.6320 - 112s/epoch - 339ms/step
Validation cm: [[578  80  51  31]
 [ 36  27  10  19]
 [ 27   5  26  19]
 [ 28  24  49  29]]
Validation normalized_cm: [[0.781 0.108 0.069 0.042]
 [0.391 0.293 0.109 0.207]
 [0.351 0.065 0.338 0.247]
 [0.215 0.185 0.377 0.223]]
Validation acc: 0.6352261790182868
Validation class_accuracies: [0.7810810810810811, 0.29347826086956524, 0.33766233766233766, 0.2230769230769231]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.40882465067247675
Validation one_indexed_epoch: 6
Epoch 6/17
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 2 epochs
330/330 - 110s - loss: 0.2105 - accuracy: 0.6381 - 110s/epoch - 334ms/step
Validation cm: [[491 140  53  56]
 [ 14  44  10  24]
 [ 20   8  18  31]
 [  8  15  43  64]]
Validation normalized_cm: [[0.664 0.189 0.072 0.076]
 [0.152 0.478 0.109 0.261]
 [0.26  0.104 0.234 0.403]
 [0.062 0.115 0.331 0.492]]
Validation acc: 0.5938402309913379
Validation class_accuracies: [0.6635135135135135, 0.4782608695652174, 0.23376623376623376, 0.49230769230769234]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.46696207728816425
Validation one_indexed_epoch: 7
Epoch 7/17
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 3 epochs
Lr has been adjusted to 0.0005000000237487257
330/330 - 113s - loss: 0.1809 - accuracy: 0.6679 - 113s/epoch - 342ms/step
Validation cm: [[610  92  28  10]
 [ 37  43   8   4]
 [ 30   7  32   8]
 [ 37  35  36  22]]
Validation normalized_cm: [[0.824 0.124 0.038 0.014]
 [0.402 0.467 0.087 0.043]
 [0.39  0.091 0.416 0.104]
 [0.285 0.269 0.277 0.169]]
Validation acc: 0.6804619826756496
Validation class_accuracies: [0.8243243243243243, 0.4673913043478261, 0.4155844155844156, 0.16923076923076924]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4691327033718338
Validation one_indexed_epoch: 8
Epoch 8/17
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 4 epochs
330/330 - 113s - loss: 0.1295 - accuracy: 0.6764 - 113s/epoch - 343ms/step
Validation cm: [[614  80  35  11]
 [ 50  30   9   3]
 [ 34   1  29  13]
 [ 47  26  39  18]]
Validation normalized_cm: [[0.83  0.108 0.047 0.015]
 [0.543 0.326 0.098 0.033]
 [0.442 0.013 0.377 0.169]
 [0.362 0.2   0.3   0.138]]
Validation acc: 0.6650625601539942
Validation class_accuracies: [0.8297297297297297, 0.32608695652173914, 0.37662337662337664, 0.13846153846153847]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.41772540033409594
Validation one_indexed_epoch: 9
Epoch 9/17
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 5 epochs
330/330 - 111s - loss: 0.1091 - accuracy: 0.6479 - 111s/epoch - 335ms/step
Validation cm: [[608  94  28  10]
 [ 35  44   7   6]
 [ 30   5  26  16]
 [ 29  19  42  40]]
Validation normalized_cm: [[0.822 0.127 0.038 0.014]
 [0.38  0.478 0.076 0.065]
 [0.39  0.065 0.338 0.208]
 [0.223 0.146 0.323 0.308]]
Validation acc: 0.6910490856592878
Validation class_accuracies: [0.8216216216216217, 0.4782608695652174, 0.33766233766233766, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.48630928413537106
Validation one_indexed_epoch: 10
Epoch 10/17
[[0. 0.]]
The number of epochs since last 1% equals the patience
Lr has been adjusted to 0.0002500000118743628
330/330 - 113s - loss: 0.0888 - accuracy: 0.6538 - 113s/epoch - 342ms/step
----------------------------------
The best metrics for this job are: 

Best avg_accuracy: 0.5494436967263054
Best cm: [[462 138  96  44]
 [ 15  55   1  21]
 [ 16   3  23  35]
 [ 12  11  19  88]]
Best normalized_cm: [[0.624 0.186 0.13  0.059]
 [0.163 0.598 0.011 0.228]
 [0.208 0.039 0.299 0.455]
 [0.092 0.085 0.146 0.677]]
Best acc: 0.6044273339749759
Best class_accuracies: [0.6243243243243243, 0.5978260869565217, 0.2987012987012987, 0.676923076923077]
Best precision: None
Best recall: None
Best f1: None
Best roc_auc: None
Best one_indexed_epoch: 4
Validation cm: [[608  94  28  10]
 [ 35  44   7   6]
 [ 30   5  26  16]
 [ 29  19  42  40]]
Validation normalized_cm: [[0.822 0.127 0.038 0.014]
 [0.38  0.478 0.076 0.065]
 [0.39  0.065 0.338 0.208]
 [0.223 0.146 0.323 0.308]]
Validation acc: 0.6910490856592878
Validation class_accuracies: [0.8216216216216217, 0.4782608695652174, 0.33766233766233766, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.48630928413537106
Validation one_indexed_epoch: 1
avg_accuracy
model
cm
normalized_cm
acc
class_accuracies
precision
recall
f1
roc_auc
one_indexed_epoch
Target metric is avg_accuracy
Epoch 1/5
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 7 epochs
330/330 - 52s - loss: 0.0535 - accuracy: 0.6887 - 52s/epoch - 158ms/step
Validation cm: [[608  94  28  10]
 [ 35  44   7   6]
 [ 30   5  26  16]
 [ 29  19  42  40]]
Validation normalized_cm: [[0.822 0.127 0.038 0.014]
 [0.38  0.478 0.076 0.065]
 [0.39  0.065 0.338 0.208]
 [0.223 0.146 0.323 0.308]]
Validation acc: 0.6910490856592878
Validation class_accuracies: [0.8216216216216217, 0.4782608695652174, 0.33766233766233766, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.48630928413537106
Validation one_indexed_epoch: 2
Epoch 2/5
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 8 epochs
330/330 - 50s - loss: 0.0535 - accuracy: 0.6887 - 50s/epoch - 152ms/step
Validation cm: [[608  94  28  10]
 [ 35  44   7   6]
 [ 30   5  26  16]
 [ 29  19  42  40]]
Validation normalized_cm: [[0.822 0.127 0.038 0.014]
 [0.38  0.478 0.076 0.065]
 [0.39  0.065 0.338 0.208]
 [0.223 0.146 0.323 0.308]]
Validation acc: 0.6910490856592878
Validation class_accuracies: [0.8216216216216217, 0.4782608695652174, 0.33766233766233766, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.48630928413537106
Validation one_indexed_epoch: 3
Epoch 3/5
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 9 epochs
Lr has been adjusted to 4.999999873689376e-05
330/330 - 48s - loss: 0.0535 - accuracy: 0.6887 - 48s/epoch - 146ms/step
Validation cm: [[608  94  28  10]
 [ 35  44   7   6]
 [ 30   5  26  16]
 [ 29  19  42  40]]
Validation normalized_cm: [[0.822 0.127 0.038 0.014]
 [0.38  0.478 0.076 0.065]
 [0.39  0.065 0.338 0.208]
 [0.223 0.146 0.323 0.308]]
Validation acc: 0.6910490856592878
Validation class_accuracies: [0.8216216216216217, 0.4782608695652174, 0.33766233766233766, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.48630928413537106
Validation one_indexed_epoch: 4
Epoch 4/5
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 10 epochs
330/330 - 48s - loss: 0.0535 - accuracy: 0.6887 - 48s/epoch - 147ms/step
Validation cm: [[608  94  28  10]
 [ 35  44   7   6]
 [ 30   5  26  16]
 [ 29  19  42  40]]
Validation normalized_cm: [[0.822 0.127 0.038 0.014]
 [0.38  0.478 0.076 0.065]
 [0.39  0.065 0.338 0.208]
 [0.223 0.146 0.323 0.308]]
Validation acc: 0.6910490856592878
Validation class_accuracies: [0.8216216216216217, 0.4782608695652174, 0.33766233766233766, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.48630928413537106
Validation one_indexed_epoch: 5
Epoch 5/5
[[0. 0.]]
The validation tracker metric at 0.5494436967263054 hasn't increased by 0 in 11 epochs
330/330 - 49s - loss: 0.0535 - accuracy: 0.6887 - 49s/epoch - 150ms/step
----------------------------------
The best metrics for this job are: 

Best avg_accuracy: 0.5494436967263054
Best cm: [[462 138  96  44]
 [ 15  55   1  21]
 [ 16   3  23  35]
 [ 12  11  19  88]]
Best normalized_cm: [[0.624 0.186 0.13  0.059]
 [0.163 0.598 0.011 0.228]
 [0.208 0.039 0.299 0.455]
 [0.092 0.085 0.146 0.677]]
Best acc: 0.6044273339749759
Best class_accuracies: [0.6243243243243243, 0.5978260869565217, 0.2987012987012987, 0.676923076923077]
Best precision: None
Best recall: None
Best f1: None
Best roc_auc: None
Best one_indexed_epoch: 4
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/keras/optimizer_v2/adam.py:105: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  super(Adam, self).__init__(name, **kwargs)
/home/alirachidi/classification_algorithm/trainers/modules/main/global_helpers.py:48: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  plt.show()
avg_accuracy
model
cm
normalized_cm
acc
class_accuracies
precision
recall
f1
roc_auc
one_indexed_epoch
