Validation cm: [[740   0   0   0]
 [ 92   0   0   0]
 [ 77   0   0   0]
 [130   0   0   0]]
Validation normalized_cm: [[1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]]
Validation acc: 0.7122232916265641
Validation class_accuracies: [1.0, 0.0, 0.0, 0.0]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.25
Validation one_indexed_epoch: 1
Tensorflow Version: 2.7.1
Num GPUs Available:  1
Collecting Variables...
All variables have been collected.
../cache/
cw
train22
-----------------------
Job id is 1.
- Loading Perch.
3278 Perch audios have been loaded.
- Loading Icbhi.
725 Icbhi audios have been loaded.
- Loading Antwerp.
131 Antwerp audios have been loaded.
- Preparing Perch.
862 Perch groups of audio chunks (by filename or patients) have been prepared.
- Preparing Icbhi.
112 Icbhi groups of audio chunks (by filename or patients) have been prepared.
- Preparing Antwerp.
15 Antwerp groups of audio chunks (by filename or patients) have been prepared.
--- Samples are being split into training/val groups and de-grouped by patient ---
--- Perch training dataset went from 0 to 2649 elements, with 2346 none's, 61 crakles, 186 wheezes and 56 both ---
--- Perch Validation dataset contains 629 elements, with 551 none, 12 crackles, 54 wheezes and 12 both ---
--- Icbhi training dataset went from 0 to 2040 elements, with 707 none's, 720 crakles, 285 wheezes and 327 both ---
--- Icbhi Validation dataset contains 299 elements, with 172 none, 70 crackles, 18 wheezes and 39 both ---
--- Antwerp training dataset went from 0 to 580 elements, with 82 none's, 16 crakles, 448 wheezes and 34 both ---
--- Antwerp Validation dataset contains 111 elements, with 17 none, 10 crackles, 5 wheezes and 79 both ---
-----------------------
--- Final training dataset went from 0 to 5269 elements, with 3135 none's, 797 crakles, 919 wheezes and 417 both ---
--- Final Validation dataset contains 1039 elements, with 740 none, 92 crackles, 77 wheezes and 130 both ---
Model: "leaf_model"
______________________________________________________________________________________________________________
 Layer (type)                                    Output Shape                                Param #          
==============================================================================================================
 leaf (Leaf)                                     multiple                                    560              
                                                                                                              
 sequential (Sequential)                         (None, 128)                                 105694           
                                                                                                              
 dense (Dense)                                   multiple                                    258              
                                                                                                              
==============================================================================================================
Total params: 106,512
Trainable params: 105,456
Non-trainable params: 1,056
______________________________________________________________________________________________________________
Target metric is avg_accuracy
Epoch 1/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 313s - loss: 0.4346 - accuracy: 0.6016 - 313s/epoch - 950ms/step
Validation cm: [[709  21  10   0]
 [ 71   9  12   0]
 [ 54   1  20   2]
 [ 70   1  55   4]]
Validation normalized_cm: [[0.958 0.028 0.014 0.   ]
 [0.772 0.098 0.13  0.   ]
 [0.701 0.013 0.26  0.026]
 [0.538 0.008 0.423 0.031]]
Validation acc: 0.714148219441771
Validation class_accuracies: [0.9581081081081081, 0.09782608695652174, 0.2597402597402597, 0.03076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3366109213935301
Validation one_indexed_epoch: 2
Epoch 2/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 305s - loss: 0.3441 - accuracy: 0.6544 - 305s/epoch - 924ms/step
Validation cm: [[729  10   1   0]
 [ 82   4   6   0]
 [ 69   0   8   0]
 [ 71   1  55   3]]
Validation normalized_cm: [[0.985 0.014 0.001 0.   ]
 [0.891 0.043 0.065 0.   ]
 [0.896 0.    0.104 0.   ]
 [0.546 0.008 0.423 0.023]]
Validation acc: 0.7160731472569779
Validation class_accuracies: [0.9851351351351352, 0.043478260869565216, 0.1038961038961039, 0.023076923076923078]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.2888966057444318
Validation one_indexed_epoch: 3
Epoch 3/17
[[0. 0.]]
The validation tracker metric at 0.3366109213935301 hasn't increased by 0 in 1 epochs
330/330 - 309s - loss: 0.3086 - accuracy: 0.6698 - 309s/epoch - 938ms/step
Validation cm: [[621 111   6   2]
 [ 26  55   9   2]
 [ 51   6  14   6]
 [ 30  13  63  24]]
Validation normalized_cm: [[0.839 0.15  0.008 0.003]
 [0.283 0.598 0.098 0.022]
 [0.662 0.078 0.182 0.078]
 [0.231 0.1   0.485 0.185]]
Validation acc: 0.687199230028874
Validation class_accuracies: [0.8391891891891892, 0.5978260869565217, 0.18181818181818182, 0.18461538461538463]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45086221064481935
Validation one_indexed_epoch: 4
Epoch 4/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 316s - loss: 0.2694 - accuracy: 0.6576 - 316s/epoch - 957ms/step
Validation cm: [[677  39  18   6]
 [ 65  16   6   5]
 [ 46   1  26   4]
 [ 63   0  56  11]]
Validation normalized_cm: [[0.915 0.053 0.024 0.008]
 [0.707 0.174 0.065 0.054]
 [0.597 0.013 0.338 0.052]
 [0.485 0.    0.431 0.085]]
Validation acc: 0.7025986525505293
Validation class_accuracies: [0.9148648648648648, 0.17391304347826086, 0.33766233766233766, 0.08461538461538462]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.377763907655212
Validation one_indexed_epoch: 5
Epoch 5/17
[[0. 0.]]
The validation tracker metric at 0.45086221064481935 hasn't increased by 0 in 1 epochs
330/330 - 316s - loss: 0.2371 - accuracy: 0.6593 - 316s/epoch - 959ms/step
Validation cm: [[579 159   2   0]
 [ 35  53   3   1]
 [ 44  28   3   2]
 [ 43  56   7  24]]
Validation normalized_cm: [[0.782 0.215 0.003 0.   ]
 [0.38  0.576 0.033 0.011]
 [0.571 0.364 0.039 0.026]
 [0.331 0.431 0.054 0.185]]
Validation acc: 0.6342637151106834
Validation class_accuracies: [0.7824324324324324, 0.5760869565217391, 0.03896103896103896, 0.18461538461538463]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.39552395313264876
Validation one_indexed_epoch: 6
Epoch 6/17
[[0. 0.]]
The validation tracker metric at 0.45086221064481935 hasn't increased by 0 in 2 epochs
330/330 - 318s - loss: 0.1968 - accuracy: 0.6747 - 318s/epoch - 964ms/step
Validation cm: [[639  69  24   8]
 [ 44  29  16   3]
 [ 33   6  35   3]
 [ 23  11  72  24]]
Validation normalized_cm: [[0.864 0.093 0.032 0.011]
 [0.478 0.315 0.174 0.033]
 [0.429 0.078 0.455 0.039]
 [0.177 0.085 0.554 0.185]]
Validation acc: 0.699711260827719
Validation class_accuracies: [0.8635135135135135, 0.31521739130434784, 0.45454545454545453, 0.18461538461538463]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45447293599467514
Validation one_indexed_epoch: 7
Epoch 7/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 321s - loss: 0.1726 - accuracy: 0.6939 - 321s/epoch - 972ms/step
Validation cm: [[716  15   6   3]
 [ 71  11  10   0]
 [ 55   2  19   1]
 [ 53   0  65  12]]
Validation normalized_cm: [[0.968 0.02  0.008 0.004]
 [0.772 0.12  0.109 0.   ]
 [0.714 0.026 0.247 0.013]
 [0.408 0.    0.5   0.092]]
Validation acc: 0.7295476419634264
Validation class_accuracies: [0.9675675675675676, 0.11956521739130435, 0.24675324675324675, 0.09230769230769231]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3565484310049527
Validation one_indexed_epoch: 8
Epoch 8/17
[[0. 0.]]
The validation tracker metric at 0.45447293599467514 hasn't increased by 0 in 1 epochs
330/330 - 308s - loss: 0.1440 - accuracy: 0.6768 - 308s/epoch - 935ms/step
Validation cm: [[618  71  36  15]
 [ 35  38  13   6]
 [ 28   6  38   5]
 [ 20   8  63  39]]
Validation normalized_cm: [[0.835 0.096 0.049 0.02 ]
 [0.38  0.413 0.141 0.065]
 [0.364 0.078 0.494 0.065]
 [0.154 0.062 0.485 0.3  ]]
Validation acc: 0.7054860442733397
Validation class_accuracies: [0.8351351351351352, 0.41304347826086957, 0.4935064935064935, 0.3]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5104212767256245
Validation one_indexed_epoch: 9
Epoch 9/17
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 300s - loss: 0.1217 - accuracy: 0.6698 - 300s/epoch - 908ms/step
Validation cm: [[539 108  78  15]
 [ 25  41  14  12]
 [ 19   5  39  14]
 [ 10  15  62  43]]
Validation normalized_cm: [[0.728 0.146 0.105 0.02 ]
 [0.272 0.446 0.152 0.13 ]
 [0.247 0.065 0.506 0.182]
 [0.077 0.115 0.477 0.331]]
Validation acc: 0.6371511068334937
Validation class_accuracies: [0.7283783783783784, 0.44565217391304346, 0.5064935064935064, 0.33076923076923076]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.5028233223885398
Validation one_indexed_epoch: 10
Epoch 10/17
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 1 epochs
330/330 - 300s - loss: 0.0916 - accuracy: 0.6690 - 300s/epoch - 910ms/step
Validation cm: [[630  87  18   5]
 [ 44  36  10   2]
 [ 45   8  13  11]
 [ 28  19  47  36]]
Validation normalized_cm: [[0.851 0.118 0.024 0.007]
 [0.478 0.391 0.109 0.022]
 [0.584 0.104 0.169 0.143]
 [0.215 0.146 0.362 0.277]]
Validation acc: 0.6881616939364774
Validation class_accuracies: [0.8513513513513513, 0.391304347826087, 0.16883116883116883, 0.27692307692307694]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.422102486232921
Validation one_indexed_epoch: 11
Epoch 11/17
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 2 epochs
330/330 - 300s - loss: 0.0854 - accuracy: 0.6603 - 300s/epoch - 910ms/step
Validation cm: [[559 151  10  20]
 [ 16  44  13  19]
 [ 31  17  12  17]
 [ 16  27  48  39]]
Validation normalized_cm: [[0.755 0.204 0.014 0.027]
 [0.174 0.478 0.141 0.207]
 [0.403 0.221 0.156 0.221]
 [0.123 0.208 0.369 0.3  ]]
Validation acc: 0.629451395572666
Validation class_accuracies: [0.7554054054054054, 0.4782608695652174, 0.15584415584415584, 0.3]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.42237760770369465
Validation one_indexed_epoch: 12
Epoch 12/17
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 3 epochs
Lr has been adjusted to 0.0005000000237487257
330/330 - 301s - loss: 0.0693 - accuracy: 0.6656 - 301s/epoch - 912ms/step
Validation cm: [[655  56  18  11]
 [ 45  28  12   7]
 [ 37   6  30   4]
 [ 31   6  63  30]]
Validation normalized_cm: [[0.885 0.076 0.024 0.015]
 [0.489 0.304 0.13  0.076]
 [0.481 0.078 0.39  0.052]
 [0.238 0.046 0.485 0.231]]
Validation acc: 0.7151106833493744
Validation class_accuracies: [0.8851351351351351, 0.30434782608695654, 0.38961038961038963, 0.23076923076923078]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.452465645400428
Validation one_indexed_epoch: 13
Epoch 13/17
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 4 epochs
330/330 - 301s - loss: 0.0393 - accuracy: 0.6381 - 301s/epoch - 912ms/step
Validation cm: [[680  50   9   1]
 [ 52  24  13   3]
 [ 50   6  17   4]
 [ 40   8  57  25]]
Validation normalized_cm: [[0.919 0.068 0.012 0.001]
 [0.565 0.261 0.141 0.033]
 [0.649 0.078 0.221 0.052]
 [0.308 0.062 0.438 0.192]]
Validation acc: 0.7179980750721848
Validation class_accuracies: [0.918918918918919, 0.2608695652173913, 0.22077922077922077, 0.19230769230769232]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3982188493058058
Validation one_indexed_epoch: 14
Epoch 14/17
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 5 epochs
330/330 - 300s - loss: 0.0291 - accuracy: 0.6392 - 300s/epoch - 908ms/step
Validation cm: [[616  73  36  15]
 [ 28  33  17  14]
 [ 26   6  33  12]
 [ 22  14  57  37]]
Validation normalized_cm: [[0.832 0.099 0.049 0.02 ]
 [0.304 0.359 0.185 0.152]
 [0.338 0.078 0.429 0.156]
 [0.169 0.108 0.438 0.285]]
Validation acc: 0.6920115495668913
Validation class_accuracies: [0.8324324324324325, 0.358695652173913, 0.42857142857142855, 0.2846153846153846]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4760787244482897
Validation one_indexed_epoch: 15
Epoch 15/17
[[0. 0.]]
The number of epochs since last 1% equals the patience
Lr has been adjusted to 0.0002500000118743628
330/330 - 299s - loss: 0.0294 - accuracy: 0.6478 - 299s/epoch - 907ms/step
----------------------------------
The best metrics for this job are: 

Best avg_accuracy: 0.5104212767256245
Best cm: [[618  71  36  15]
 [ 35  38  13   6]
 [ 28   6  38   5]
 [ 20   8  63  39]]
Best normalized_cm: [[0.835 0.096 0.049 0.02 ]
 [0.38  0.413 0.141 0.065]
 [0.364 0.078 0.494 0.065]
 [0.154 0.062 0.485 0.3  ]]
Best acc: 0.7054860442733397
Best class_accuracies: [0.8351351351351352, 0.41304347826086957, 0.4935064935064935, 0.3]
Best precision: None
Best recall: None
Best f1: None
Best roc_auc: None
Best one_indexed_epoch: 9
Validation cm: [[627  70  31  12]
 [ 38  29  12  13]
 [ 31   6  33   7]
 [ 30  14  54  32]]
Validation normalized_cm: [[0.847 0.095 0.042 0.016]
 [0.413 0.315 0.13  0.141]
 [0.403 0.078 0.429 0.091]
 [0.231 0.108 0.415 0.246]]
Validation acc: 0.6939364773820982
Validation class_accuracies: [0.8472972972972973, 0.31521739130434784, 0.42857142857142855, 0.24615384615384617]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45930999083172996
Validation one_indexed_epoch: 1
avg_accuracy
model
cm
normalized_cm
acc
class_accuracies
precision
recall
f1
roc_auc
one_indexed_epoch
Target metric is avg_accuracy
Epoch 1/5
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 7 epochs
330/330 - 451s - loss: 0.0105 - accuracy: 0.6483 - 451s/epoch - 1s/step
Validation cm: [[631  69  30  10]
 [ 39  28  13  12]
 [ 34   7  30   6]
 [ 33  15  52  30]]
Validation normalized_cm: [[0.853 0.093 0.041 0.014]
 [0.424 0.304 0.141 0.13 ]
 [0.442 0.091 0.39  0.078]
 [0.254 0.115 0.4   0.231]]
Validation acc: 0.6920115495668913
Validation class_accuracies: [0.8527027027027027, 0.30434782608695654, 0.38961038961038963, 0.23076923076923078]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.44435753729231986
Validation one_indexed_epoch: 2
Epoch 2/5
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 8 epochs
330/330 - 449s - loss: 0.0098 - accuracy: 0.6459 - 449s/epoch - 1s/step
Validation cm: [[633  67  30  10]
 [ 39  28  14  11]
 [ 33   7  30   7]
 [ 31  13  55  31]]
Validation normalized_cm: [[0.855 0.091 0.041 0.014]
 [0.424 0.304 0.152 0.12 ]
 [0.429 0.091 0.39  0.091]
 [0.238 0.1   0.423 0.238]]
Validation acc: 0.6948989412897016
Validation class_accuracies: [0.8554054054054054, 0.30434782608695654, 0.38961038961038963, 0.23846153846153847]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4469562898910725
Validation one_indexed_epoch: 3
Epoch 3/5
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 9 epochs
Lr has been adjusted to 4.999999873689376e-05
330/330 - 448s - loss: 0.0096 - accuracy: 0.6476 - 448s/epoch - 1s/step
Validation cm: [[632  67  30  11]
 [ 41  27  13  11]
 [ 33   7  31   6]
 [ 32  13  55  30]]
Validation normalized_cm: [[0.854 0.091 0.041 0.015]
 [0.446 0.293 0.141 0.12 ]
 [0.429 0.091 0.403 0.078]
 [0.246 0.1   0.423 0.231]]
Validation acc: 0.6929740134744947
Validation class_accuracies: [0.8540540540540541, 0.29347826086956524, 0.4025974025974026, 0.23076923076923078]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4452247370725632
Validation one_indexed_epoch: 4
Epoch 4/5
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 10 epochs
330/330 - 450s - loss: 0.0091 - accuracy: 0.6422 - 450s/epoch - 1s/step
Validation cm: [[634  67  30   9]
 [ 40  27  13  12]
 [ 34   7  30   6]
 [ 33  13  54  30]]
Validation normalized_cm: [[0.857 0.091 0.041 0.012]
 [0.435 0.293 0.141 0.13 ]
 [0.442 0.091 0.39  0.078]
 [0.254 0.1   0.415 0.231]]
Validation acc: 0.6939364773820982
Validation class_accuracies: [0.8567567567567568, 0.29347826086956524, 0.38961038961038963, 0.23076923076923078]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4426536595014856
Validation one_indexed_epoch: 5
Epoch 5/5
[[0. 0.]]
The validation tracker metric at 0.5104212767256245 hasn't increased by 0 in 11 epochs
330/330 - 467s - loss: 0.0090 - accuracy: 0.6424 - 467s/epoch - 1s/step
----------------------------------
The best metrics for this job are: 

Best avg_accuracy: 0.5104212767256245
Best cm: [[618  71  36  15]
 [ 35  38  13   6]
 [ 28   6  38   5]
 [ 20   8  63  39]]
Best normalized_cm: [[0.835 0.096 0.049 0.02 ]
 [0.38  0.413 0.141 0.065]
 [0.364 0.078 0.494 0.065]
 [0.154 0.062 0.485 0.3  ]]
Best acc: 0.7054860442733397
Best class_accuracies: [0.8351351351351352, 0.41304347826086957, 0.4935064935064935, 0.3]
Best precision: None
Best recall: None
Best f1: None
Best roc_auc: None
Best one_indexed_epoch: 9
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/keras/optimizer_v2/adam.py:105: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  super(Adam, self).__init__(name, **kwargs)
/home/alirachidi/classification_algorithm/trainers/modules/main/global_helpers.py:48: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  plt.show()
avg_accuracy
model
cm
normalized_cm
acc
class_accuracies
precision
recall
f1
roc_auc
one_indexed_epoch
