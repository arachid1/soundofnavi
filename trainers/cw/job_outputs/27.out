Validation cm: [[740   0   0   0]
 [ 92   0   0   0]
 [ 77   0   0   0]
 [130   0   0   0]]
Validation normalized_cm: [[1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]
 [1. 0. 0. 0.]]
Validation acc: 0.7122232916265641
Validation class_accuracies: [1.0, 0.0, 0.0, 0.0]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.25
Validation one_indexed_epoch: 1
Tensorflow Version: 2.7.1
Num GPUs Available:  1
Collecting Variables...
All variables have been collected.
../cache/
cw
train27
-----------------------
Job id is 1.
- Loading Perch.
3278 Perch audios have been loaded.
- Loading Icbhi.
725 Icbhi audios have been loaded.
- Loading Antwerp.
131 Antwerp audios have been loaded.
- Preparing Perch.
862 Perch groups of audio chunks (by filename or patients) have been prepared.
- Preparing Icbhi.
112 Icbhi groups of audio chunks (by filename or patients) have been prepared.
- Preparing Antwerp.
15 Antwerp groups of audio chunks (by filename or patients) have been prepared.
--- Samples are being split into training/val groups and de-grouped by patient ---
--- Perch training dataset went from 0 to 2649 elements, with 2346 none's, 61 crakles, 186 wheezes and 56 both ---
--- Perch Validation dataset contains 629 elements, with 551 none, 12 crackles, 54 wheezes and 12 both ---
--- Icbhi training dataset went from 0 to 2040 elements, with 707 none's, 720 crakles, 285 wheezes and 327 both ---
--- Icbhi Validation dataset contains 299 elements, with 172 none, 70 crackles, 18 wheezes and 39 both ---
--- Antwerp training dataset went from 0 to 580 elements, with 82 none's, 16 crakles, 448 wheezes and 34 both ---
--- Antwerp Validation dataset contains 111 elements, with 17 none, 10 crackles, 5 wheezes and 79 both ---
-----------------------
--- Final training dataset went from 0 to 5269 elements, with 3135 none's, 797 crakles, 919 wheezes and 417 both ---
--- Final Validation dataset contains 1039 elements, with 740 none, 92 crackles, 77 wheezes and 130 both ---
Model: "leaf_model"
______________________________________________________________________________________________________________
 Layer (type)                                    Output Shape                                Param #          
==============================================================================================================
 leaf (Leaf)                                     multiple                                    560              
                                                                                                              
 sequential (Sequential)                         (None, 128)                                 105694           
                                                                                                              
 dense (Dense)                                   multiple                                    258              
                                                                                                              
==============================================================================================================
Total params: 106,512
Trainable params: 106,016
Non-trainable params: 496
______________________________________________________________________________________________________________
Target metric is avg_accuracy
Epoch 1/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 512s - loss: 0.4370 - accuracy: 0.6119 - 512s/epoch - 2s/step
Validation cm: [[707  20  12   1]
 [ 69   8  13   2]
 [ 50   1  24   2]
 [ 61   2  61   6]]
Validation normalized_cm: [[0.955 0.027 0.016 0.001]
 [0.75  0.087 0.141 0.022]
 [0.649 0.013 0.312 0.026]
 [0.469 0.015 0.469 0.046]]
Validation acc: 0.7170356111645814
Validation class_accuracies: [0.9554054054054054, 0.08695652173913043, 0.3116883116883117, 0.046153846153846156]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3500510212466735
Validation one_indexed_epoch: 2
Epoch 2/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 514s - loss: 0.3461 - accuracy: 0.6462 - 514s/epoch - 2s/step
Validation cm: [[706  16  15   3]
 [ 70  15   5   2]
 [ 45   1  29   2]
 [ 43   1  78   8]]
Validation normalized_cm: [[0.954 0.022 0.02  0.004]
 [0.761 0.163 0.054 0.022]
 [0.584 0.013 0.377 0.026]
 [0.331 0.008 0.6   0.062]]
Validation acc: 0.7295476419634264
Validation class_accuracies: [0.9540540540540541, 0.16304347826086957, 0.37662337662337664, 0.06153846153846154]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.38881484261919047
Validation one_indexed_epoch: 3
Epoch 3/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 513s - loss: 0.3122 - accuracy: 0.6599 - 513s/epoch - 2s/step
Validation cm: [[671  61   5   3]
 [ 51  32   7   2]
 [ 61   0  15   1]
 [ 41   6  78   5]]
Validation normalized_cm: [[0.907 0.082 0.007 0.004]
 [0.554 0.348 0.076 0.022]
 [0.792 0.    0.195 0.013]
 [0.315 0.046 0.6   0.038]]
Validation acc: 0.6958614051973051
Validation class_accuracies: [0.9067567567567567, 0.34782608695652173, 0.19480519480519481, 0.038461538461538464]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.37196239424500294
Validation one_indexed_epoch: 4
Epoch 4/20
[[0. 0.]]
The validation tracker metric at 0.38881484261919047 hasn't increased by 0 in 1 epochs
330/330 - 512s - loss: 0.2729 - accuracy: 0.6561 - 512s/epoch - 2s/step
Validation cm: [[697  37   5   1]
 [ 78  11   0   3]
 [ 63   3   7   4]
 [ 76   1  45   8]]
Validation normalized_cm: [[0.942 0.05  0.007 0.001]
 [0.848 0.12  0.    0.033]
 [0.818 0.039 0.091 0.052]
 [0.585 0.008 0.346 0.062]]
Validation acc: 0.6958614051973051
Validation class_accuracies: [0.9418918918918919, 0.11956521739130435, 0.09090909090909091, 0.06153846153846154]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3034761654326872
Validation one_indexed_epoch: 5
Epoch 5/20
[[0. 0.]]
The validation tracker metric at 0.38881484261919047 hasn't increased by 0 in 2 epochs
330/330 - 513s - loss: 0.2464 - accuracy: 0.6531 - 513s/epoch - 2s/step
Validation cm: [[553 180   3   4]
 [ 20  64   4   4]
 [ 46  19   5   7]
 [ 24  44  27  35]]
Validation normalized_cm: [[0.747 0.243 0.004 0.005]
 [0.217 0.696 0.043 0.043]
 [0.597 0.247 0.065 0.091]
 [0.185 0.338 0.208 0.269]]
Validation acc: 0.6323387872954764
Validation class_accuracies: [0.7472972972972973, 0.6956521739130435, 0.06493506493506493, 0.2692307692307692]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4442788263440437
Validation one_indexed_epoch: 6
Epoch 6/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 499s - loss: 0.2084 - accuracy: 0.6610 - 499s/epoch - 2s/step
Validation cm: [[594  89  36  21]
 [ 24  43  11  14]
 [ 31   4  35   7]
 [ 13  10  82  25]]
Validation normalized_cm: [[0.803 0.12  0.049 0.028]
 [0.261 0.467 0.12  0.152]
 [0.403 0.052 0.455 0.091]
 [0.1   0.077 0.631 0.192]]
Validation acc: 0.670837343599615
Validation class_accuracies: [0.8027027027027027, 0.4673913043478261, 0.45454545454545453, 0.19230769230769232]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.47923678847591894
Validation one_indexed_epoch: 7
Epoch 7/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 492s - loss: 0.1842 - accuracy: 0.6956 - 492s/epoch - 1s/step
Validation cm: [[618  37  78   7]
 [ 44  17  20  11]
 [ 29   0  46   2]
 [ 32   3  80  15]]
Validation normalized_cm: [[0.835 0.05  0.105 0.009]
 [0.478 0.185 0.217 0.12 ]
 [0.377 0.    0.597 0.026]
 [0.246 0.023 0.615 0.115]]
Validation acc: 0.6698748796920115
Validation class_accuracies: [0.8351351351351352, 0.18478260869565216, 0.5974025974025974, 0.11538461538461539]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.43317623915450004
Validation one_indexed_epoch: 8
Epoch 8/20
[[0. 0.]]
The validation tracker metric at 0.47923678847591894 hasn't increased by 0 in 1 epochs
330/330 - 490s - loss: 0.1548 - accuracy: 0.6897 - 490s/epoch - 1s/step
Validation cm: [[488 175  40  37]
 [ 17  42  11  22]
 [ 20   8  27  22]
 [  9   4  57  60]]
Validation normalized_cm: [[0.659 0.236 0.054 0.05 ]
 [0.185 0.457 0.12  0.239]
 [0.26  0.104 0.351 0.286]
 [0.069 0.031 0.438 0.462]]
Validation acc: 0.5938402309913379
Validation class_accuracies: [0.6594594594594595, 0.45652173913043476, 0.35064935064935066, 0.46153846153846156]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4820422526944266
Validation one_indexed_epoch: 9
Epoch 9/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 491s - loss: 0.1335 - accuracy: 0.6664 - 491s/epoch - 1s/step
Validation cm: [[629  94  14   3]
 [ 32  44   9   7]
 [ 48   4  19   6]
 [ 40  10  65  15]]
Validation normalized_cm: [[0.85  0.127 0.019 0.004]
 [0.348 0.478 0.098 0.076]
 [0.623 0.052 0.247 0.078]
 [0.308 0.077 0.5   0.115]]
Validation acc: 0.6804619826756496
Validation class_accuracies: [0.85, 0.4782608695652174, 0.24675324675324675, 0.11538461538461539]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.4225996829257699
Validation one_indexed_epoch: 10
Epoch 10/20
[[0. 0.]]
The validation tracker metric at 0.4820422526944266 hasn't increased by 0 in 1 epochs
330/330 - 491s - loss: 0.1054 - accuracy: 0.6664 - 491s/epoch - 1s/step
Validation cm: [[636  49  47   8]
 [ 48  24  16   4]
 [ 31   0  40   6]
 [ 20   1  87  22]]
Validation normalized_cm: [[0.859 0.066 0.064 0.011]
 [0.522 0.261 0.174 0.043]
 [0.403 0.    0.519 0.078]
 [0.154 0.008 0.669 0.169]]
Validation acc: 0.6948989412897016
Validation class_accuracies: [0.8594594594594595, 0.2608695652173913, 0.5194805194805194, 0.16923076923076924]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.45226007834703486
Validation one_indexed_epoch: 11
Epoch 11/20
[[0. 0.]]
The validation tracker metric at 0.4820422526944266 hasn't increased by 0 in 2 epochs
330/330 - 490s - loss: 0.0931 - accuracy: 0.6652 - 490s/epoch - 1s/step
Validation cm: [[624  60  41  15]
 [ 39  20  17  16]
 [ 32   1  37   7]
 [ 19   9  78  24]]
Validation normalized_cm: [[0.843 0.081 0.055 0.02 ]
 [0.424 0.217 0.185 0.174]
 [0.416 0.013 0.481 0.091]
 [0.146 0.069 0.6   0.185]]
Validation acc: 0.6785370548604427
Validation class_accuracies: [0.8432432432432433, 0.21739130434782608, 0.4805194805194805, 0.18461538461538463]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.43144235318148366
Validation one_indexed_epoch: 12
Epoch 12/20
[[0. 0.]]
The validation tracker metric at 0.4820422526944266 hasn't increased by 0 in 3 epochs
330/330 - 490s - loss: 0.0873 - accuracy: 0.6681 - 490s/epoch - 1s/step
Validation cm: [[507 138  47  48]
 [ 17  36  10  29]
 [ 18   8  28  23]
 [  7  12  41  70]]
Validation normalized_cm: [[0.685 0.186 0.064 0.065]
 [0.185 0.391 0.109 0.315]
 [0.234 0.104 0.364 0.299]
 [0.054 0.092 0.315 0.538]]
Validation acc: 0.6169393647738209
Validation class_accuracies: [0.6851351351351351, 0.391304347826087, 0.36363636363636365, 0.5384615384615384]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.494634346264781
Validation one_indexed_epoch: 13
Epoch 13/20
[[0. 0.]]
-- New best results were achieved. --
Saving model...
330/330 - 488s - loss: 0.0622 - accuracy: 0.6426 - 488s/epoch - 1s/step
Validation cm: [[697  35   8   0]
 [ 62  18   9   3]
 [ 61   0  13   3]
 [ 47   7  61  15]]
Validation normalized_cm: [[0.942 0.047 0.011 0.   ]
 [0.674 0.196 0.098 0.033]
 [0.792 0.    0.169 0.039]
 [0.362 0.054 0.469 0.115]]
Validation acc: 0.7151106833493744
Validation class_accuracies: [0.9418918918918919, 0.1956521739130435, 0.16883116883116883, 0.11538461538461539]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3554399625051799
Validation one_indexed_epoch: 14
Epoch 14/20
[[0. 0.]]
The validation tracker metric at 0.494634346264781 hasn't increased by 0 in 1 epochs
330/330 - 486s - loss: 0.0526 - accuracy: 0.6607 - 486s/epoch - 1s/step
Validation cm: [[545  67  92  36]
 [ 24  27  15  26]
 [ 17   2  40  18]
 [ 10   7  73  40]]
Validation normalized_cm: [[0.736 0.091 0.124 0.049]
 [0.261 0.293 0.163 0.283]
 [0.221 0.026 0.519 0.234]
 [0.077 0.054 0.562 0.308]]
Validation acc: 0.6275264677574591
Validation class_accuracies: [0.7364864864864865, 0.29347826086956524, 0.5194805194805194, 0.3076923076923077]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.46428439363221974
Validation one_indexed_epoch: 15
Epoch 15/20
[[0. 1.]]
The validation tracker metric at 0.494634346264781 hasn't increased by 0 in 2 epochs
330/330 - 487s - loss: 0.0568 - accuracy: 0.6563 - 487s/epoch - 1s/step
Validation cm: [[567  48 111  14]
 [ 32  15  31  14]
 [ 26   0  44   7]
 [ 10   5 104  11]]
Validation normalized_cm: [[0.766 0.065 0.15  0.019]
 [0.348 0.163 0.337 0.152]
 [0.338 0.    0.571 0.091]
 [0.077 0.038 0.8   0.085]]
Validation acc: 0.6130895091434071
Validation class_accuracies: [0.7662162162162162, 0.16304347826086957, 0.5714285714285714, 0.08461538461538462]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3963259126302604
Validation one_indexed_epoch: 16
Epoch 16/20
[[0. 0.]]
The validation tracker metric at 0.494634346264781 hasn't increased by 0 in 3 epochs
330/330 - 487s - loss: 0.0536 - accuracy: 0.6724 - 487s/epoch - 1s/step
Validation cm: [[551  91  62  36]
 [ 24  25  17  26]
 [ 22   5  31  19]
 [ 13  10  68  39]]
Validation normalized_cm: [[0.745 0.123 0.084 0.049]
 [0.261 0.272 0.185 0.283]
 [0.286 0.065 0.403 0.247]
 [0.1   0.077 0.523 0.3  ]]
Validation acc: 0.6217516843118384
Validation class_accuracies: [0.7445945945945946, 0.2717391304347826, 0.4025974025974026, 0.3]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.429732781906695
Validation one_indexed_epoch: 17
Epoch 17/20
[[0. 0.]]
The validation tracker metric at 0.494634346264781 hasn't increased by 0 in 4 epochs
330/330 - 488s - loss: 0.0345 - accuracy: 0.6555 - 488s/epoch - 1s/step
Validation cm: [[618  97  14  11]
 [ 31  37  13  11]
 [ 40   9  19   9]
 [ 26  17  54  33]]
Validation normalized_cm: [[0.835 0.131 0.019 0.015]
 [0.337 0.402 0.141 0.12 ]
 [0.519 0.117 0.247 0.117]
 [0.2   0.131 0.415 0.254]]
Validation acc: 0.6804619826756496
Validation class_accuracies: [0.8351351351351352, 0.40217391304347827, 0.24675324675324675, 0.25384615384615383]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.43447711219450347
Validation one_indexed_epoch: 18
Epoch 18/20
[[0. 0.]]
The validation tracker metric at 0.494634346264781 hasn't increased by 0 in 5 epochs
330/330 - 487s - loss: 0.0397 - accuracy: 0.6512 - 487s/epoch - 1s/step
Validation cm: [[636   6  88  10]
 [ 46   5  30  11]
 [ 30   1  38   8]
 [ 14   0  96  20]]
Validation normalized_cm: [[0.859 0.008 0.119 0.014]
 [0.5   0.054 0.326 0.12 ]
 [0.39  0.013 0.494 0.104]
 [0.108 0.    0.738 0.154]]
Validation acc: 0.6727622714148219
Validation class_accuracies: [0.8594594594594595, 0.05434782608695652, 0.4935064935064935, 0.15384615384615385]
Validation precision: None
Validation recall: None
Validation f1: None
Validation roc_auc: None
Validation avg_accuracy: 0.3902899832247658
Validation one_indexed_epoch: 19
Epoch 19/20
[[0. 0.]]
The number of epochs since last 1% equals the patience
330/330 - 487s - loss: 0.0402 - accuracy: 0.6540 - 487s/epoch - 1s/step
----------------------------------
The best metrics for this job are: 

Best avg_accuracy: 0.494634346264781
Best cm: [[507 138  47  48]
 [ 17  36  10  29]
 [ 18   8  28  23]
 [  7  12  41  70]]
Best normalized_cm: [[0.685 0.186 0.064 0.065]
 [0.185 0.391 0.109 0.315]
 [0.234 0.104 0.364 0.299]
 [0.054 0.092 0.315 0.538]]
Best acc: 0.6169393647738209
Best class_accuracies: [0.6851351351351351, 0.391304347826087, 0.36363636363636365, 0.5384615384615384]
Best precision: None
Best recall: None
Best f1: None
Best roc_auc: None
Best one_indexed_epoch: 13
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/keras/optimizer_v2/adam.py:105: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  super(Adam, self).__init__(name, **kwargs)
/home/alirachidi/classification_algorithm/trainers/modules/main/global_helpers.py:48: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  plt.show()
avg_accuracy
model
cm
normalized_cm
acc
class_accuracies
precision
recall
f1
roc_auc
one_indexed_epoch
