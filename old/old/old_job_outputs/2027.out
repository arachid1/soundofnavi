Category:  coch
Dataset:  all_sw_coch_preprocessed_v2_param_v26_augm_v0_cleaned_8000.pkl
File:  conv.train2027
Description:  mod10_inc
2021-03-30 10:41:10.232627: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-03-30 10:41:12.917734: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-03-30 10:41:12.918905: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2021-03-30 10:41:12.980515: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:12.981295: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:00:05.0 name: Tesla T4 computeCapability: 7.5
coreClock: 1.59GHz coreCount: 40 deviceMemorySize: 14.75GiB deviceMemoryBandwidth: 298.08GiB/s
2021-03-30 10:41:12.981351: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-03-30 10:41:12.985617: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-03-30 10:41:12.985745: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-03-30 10:41:12.987193: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-03-30 10:41:12.987627: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-03-30 10:41:12.988907: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-03-30 10:41:12.989975: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-03-30 10:41:12.991018: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-03-30 10:41:12.991188: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:12.992016: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:12.992716: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2021-03-30 10:41:12.995035: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-03-30 10:41:12.995258: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:12.996306: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:00:05.0 name: Tesla T4 computeCapability: 7.5
coreClock: 1.59GHz coreCount: 40 deviceMemorySize: 14.75GiB deviceMemoryBandwidth: 298.08GiB/s
2021-03-30 10:41:12.996355: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-03-30 10:41:12.996413: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-03-30 10:41:12.996447: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-03-30 10:41:12.996474: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-03-30 10:41:12.996499: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-03-30 10:41:12.996546: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-03-30 10:41:12.996586: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-03-30 10:41:12.996619: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-03-30 10:41:12.996743: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:12.997826: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:12.998802: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2021-03-30 10:41:12.998867: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-03-30 10:41:13.874417: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2021-03-30 10:41:13.874465: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2021-03-30 10:41:13.874474: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2021-03-30 10:41:13.874849: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:13.875770: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:13.876585: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-03-30 10:41:13.877269: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 13968 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:00:05.0, compute capability: 7.5)
2021-03-30 10:41:14.461157: I tensorflow/core/profiler/lib/profiler_session.cc:136] Profiler session initializing.
2021-03-30 10:41:14.461214: I tensorflow/core/profiler/lib/profiler_session.cc:155] Profiler session started.
2021-03-30 10:41:14.461255: I tensorflow/core/profiler/internal/gpu/cupti_tracer.cc:1365] Profiler found 1 GPUs
2021-03-30 10:41:14.461553: W tensorflow/stream_executor/platform/default/dso_loader.cc:60] Could not load dynamic library 'libcupti.so.11.0'; dlerror: libcupti.so.11.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda-11.2/lib64
2021-03-30 10:41:14.462484: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcupti.so
2021-03-30 10:41:14.674673: I tensorflow/core/profiler/lib/profiler_session.cc:172] Profiler session tear down.
2021-03-30 10:41:14.677608: I tensorflow/core/profiler/internal/gpu/cupti_tracer.cc:1487] CUPTI activity buffer flushed
Using TensorFlow backend.
WARNING:tensorflow:Model failed to serialize as JSON. Ignoring... name 'n_experts_per_filter' is not defined
2021-03-30 10:41:15.662422: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:116] None of the MLIR optimization passes are enabled (registered 2)
2021-03-30 10:41:15.664431: I tensorflow/core/platform/profile_utils/cpu_utils.cc:112] CPU Frequency: 2299995000 Hz
2021-03-30 10:41:18.351433: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-03-30 10:41:19.106541: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-03-30 10:41:19.128971: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-03-30 10:41:23.281425: I tensorflow/core/profiler/lib/profiler_session.cc:136] Profiler session initializing.
2021-03-30 10:41:23.281479: I tensorflow/core/profiler/lib/profiler_session.cc:155] Profiler session started.
2021-03-30 10:41:24.305712: I tensorflow/core/profiler/lib/profiler_session.cc:71] Profiler session collecting data.
2021-03-30 10:41:24.308899: I tensorflow/core/profiler/internal/gpu/cupti_tracer.cc:1487] CUPTI activity buffer flushed
2021-03-30 10:41:24.373902: I tensorflow/core/profiler/internal/gpu/cupti_collector.cc:228]  GpuTracer has collected 613 callback api events and 609 activity events. 
2021-03-30 10:41:24.403392: I tensorflow/core/profiler/lib/profiler_session.cc:172] Profiler session tear down.
WARNING:tensorflow:Callback method `on_train_batch_begin` is slow compared to the batch time (batch time: 0.1308s vs `on_train_batch_begin` time: 0.1500s). Check your callbacks.
Tensorflow Version: 2.4.0
Num GPUs Available:  1
-----------------------
Using module located at /main/models/conv/train2027.py
Using train_file located at ../../data/datasets/all_sw_coch_preprocessed_v2_param_v26_augm_v0_cleaned_8000.pkl
Using logs_path located at ../../cache/conv___03_1040___all_sw_coch_preprocessed_v2_param_v26_augm_v0_cleaned_8000___mod10_inc___2027/logs/
-----------------------
Collecting Variables...
Model Parameters: {'N_CLASSES': 2, 'SR': 8000, 'BATCH_SIZE': 16, 'LR': 0.001, 'SHAPE': (128, 1250, 3), 'WEIGHT_DECAY': 0.0001, 'LL2_REG': 0, 'EPSILON': 1e-07, 'LABEL_SMOOTHING': 0}
Learning Rate Parameters: {'factor': 0.75, 'patience': 3, 'min_lr': 1e-05}
Early Stopping Patience and Delta: 8, 1.0%
-----------------------
Size of training set: 13945
Size of validation set: 3486
Initializing weights...
weights = {0: 0.6399045521292217, 1: 1.2145345596432553, 2: 1.1234209847898944, 3: 1.3816582117945466}
Model: "conv2d"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input_1 (InputLayer)         [(None, 128, 1250, 3)]    0         
_________________________________________________________________
batch_normalization (BatchNo (None, 128, 1250, 3)      12        
_________________________________________________________________
conv2d_mo_e (Conv2DMoE)      (None, 128, 1250, 8)      7680464   
_________________________________________________________________
average_pooling2d (AveragePo (None, 64, 625, 8)        0         
_________________________________________________________________
batch_normalization_1 (Batch (None, 64, 625, 8)        32        
_________________________________________________________________
conv2d_mo_e_1 (Conv2DMoE)    (None, 64, 625, 16)       10242368  
_________________________________________________________________
average_pooling2d_1 (Average (None, 32, 313, 16)       0         
_________________________________________________________________
batch_normalization_2 (Batch (None, 32, 313, 16)       64        
_________________________________________________________________
conv2d_mo_e_2 (Conv2DMoE)    (None, 32, 313, 32)       10265728  
_________________________________________________________________
average_pooling2d_2 (Average (None, 16, 157, 32)       0         
_________________________________________________________________
batch_normalization_3 (Batch (None, 16, 157, 32)       128       
_________________________________________________________________
conv2d_mo_e_3 (Conv2DMoE)    (None, 16, 157, 64)       10326272  
_________________________________________________________________
average_pooling2d_3 (Average (None, 8, 79, 64)         0         
_________________________________________________________________
batch_normalization_4 (Batch (None, 8, 79, 64)         256       
_________________________________________________________________
conv2d_mo_e_4 (Conv2DMoE)    (None, 8, 79, 128)        10502656  
_________________________________________________________________
average_pooling2d_4 (Average (None, 4, 40, 128)        0         
_________________________________________________________________
batch_normalization_5 (Batch (None, 4, 40, 128)        512       
_________________________________________________________________
conv2d_mo_e_5 (Conv2DMoE)    (None, 4, 40, 256)        11076608  
_________________________________________________________________
average_pooling2d_5 (Average (None, 2, 20, 256)        0         
_________________________________________________________________
batch_normalization_6 (Batch (None, 2, 20, 256)        1024      
_________________________________________________________________
global_average_pooling2d (Gl (None, 256)               0         
_________________________________________________________________
dense (Dense)                (None, 2)                 514       
=================================================================
Total params: 60,096,638
Trainable params: 60,095,624
Non-trainable params: 1,014
_________________________________________________________________
Epoch 1/40
872/872 - 417s - loss: 0.4522 - calc_accuracy: 0.4601 - val_loss: 0.8145 - val_calc_accuracy: 0.4412
Epoch 2/40
872/872 - 428s - loss: 0.3849 - calc_accuracy: 0.5715 - val_loss: 0.5030 - val_calc_accuracy: 0.5990
Epoch 3/40
872/872 - 421s - loss: 0.3526 - calc_accuracy: 0.6190 - val_loss: 0.4363 - val_calc_accuracy: 0.6662
Epoch 4/40
872/872 - 451s - loss: 0.3236 - calc_accuracy: 0.6520 - val_loss: 0.4553 - val_calc_accuracy: 0.6590
Epoch 5/40
872/872 - 380s - loss: 0.3066 - calc_accuracy: 0.6680 - val_loss: 0.4145 - val_calc_accuracy: 0.6836
Epoch 6/40
872/872 - 447s - loss: 0.3175 - calc_accuracy: 0.6614 - val_loss: 0.4402 - val_calc_accuracy: 0.6759
Epoch 7/40
872/872 - 468s - loss: 0.3110 - calc_accuracy: 0.6659 - val_loss: 0.4435 - val_calc_accuracy: 0.6696
Epoch 8/40
872/872 - 452s - loss: 0.3050 - calc_accuracy: 0.6762 - val_loss: 0.6722 - val_calc_accuracy: 0.6852
Epoch 9/40
872/872 - 385s - loss: 0.2885 - calc_accuracy: 0.6984 - val_loss: 0.5288 - val_calc_accuracy: 0.7278
Epoch 10/40
872/872 - 414s - loss: 0.2820 - calc_accuracy: 0.7034 - val_loss: 0.4058 - val_calc_accuracy: 0.7346
Epoch 11/40
872/872 - 402s - loss: 0.2814 - calc_accuracy: 0.7023 - val_loss: 0.3856 - val_calc_accuracy: 0.7185
Epoch 12/40
872/872 - 400s - loss: 0.2828 - calc_accuracy: 0.7017 - val_loss: 0.3763 - val_calc_accuracy: 0.7273
Epoch 13/40
872/872 - 383s - loss: 0.2789 - calc_accuracy: 0.7051 - val_loss: 0.4434 - val_calc_accuracy: 0.7318

Epoch 00013: ReduceLROnPlateau reducing learning rate to 0.0007500000356230885.
Epoch 14/40
872/872 - 384s - loss: 0.2676 - calc_accuracy: 0.7211 - val_loss: 0.3620 - val_calc_accuracy: 0.7355
Epoch 15/40
872/872 - 390s - loss: 0.2620 - calc_accuracy: 0.7271 - val_loss: 0.3770 - val_calc_accuracy: 0.7428
Epoch 16/40
872/872 - 389s - loss: 0.2679 - calc_accuracy: 0.7134 - val_loss: 0.4022 - val_calc_accuracy: 0.6930
Epoch 17/40
872/872 - 422s - loss: 0.2587 - calc_accuracy: 0.7316 - val_loss: 0.3666 - val_calc_accuracy: 0.7615
Epoch 18/40
872/872 - 407s - loss: 0.2472 - calc_accuracy: 0.7403 - val_loss: 0.3772 - val_calc_accuracy: 0.7576
Epoch 19/40
872/872 - 387s - loss: 0.2475 - calc_accuracy: 0.7435 - val_loss: 0.3483 - val_calc_accuracy: 0.7656
Epoch 20/40
872/872 - 403s - loss: 0.2401 - calc_accuracy: 0.7536 - val_loss: 0.3412 - val_calc_accuracy: 0.7599
Epoch 21/40
872/872 - 406s - loss: 0.2383 - calc_accuracy: 0.7495 - val_loss: 0.3232 - val_calc_accuracy: 0.7685
Epoch 22/40
872/872 - 404s - loss: 0.2381 - calc_accuracy: 0.7515 - val_loss: 0.3185 - val_calc_accuracy: 0.7623
Epoch 23/40
872/872 - 389s - loss: 0.2368 - calc_accuracy: 0.7535 - val_loss: 0.3358 - val_calc_accuracy: 0.7564
Epoch 24/40
872/872 - 388s - loss: 0.2333 - calc_accuracy: 0.7539 - val_loss: 0.3087 - val_calc_accuracy: 0.7697
Epoch 25/40
872/872 - 393s - loss: 0.2269 - calc_accuracy: 0.7632 - val_loss: 0.3482 - val_calc_accuracy: 0.7751
Epoch 26/40
872/872 - 419s - loss: 0.2241 - calc_accuracy: 0.7621 - val_loss: 0.3077 - val_calc_accuracy: 0.7754
Epoch 27/40
872/872 - 449s - loss: 0.2192 - calc_accuracy: 0.7696 - val_loss: 0.3649 - val_calc_accuracy: 0.7907
Epoch 28/40
872/872 - 434s - loss: 0.2181 - calc_accuracy: 0.7727 - val_loss: 0.4693 - val_calc_accuracy: 0.7728
Epoch 29/40
872/872 - 424s - loss: 0.2168 - calc_accuracy: 0.7692 - val_loss: 0.3960 - val_calc_accuracy: 0.7755
Epoch 30/40
872/872 - 447s - loss: 0.2101 - calc_accuracy: 0.7796 - val_loss: 0.5767 - val_calc_accuracy: 0.7791

Epoch 00030: ReduceLROnPlateau reducing learning rate to 0.0005625000048894435.
Epoch 31/40
872/872 - 450s - loss: 0.2098 - calc_accuracy: 0.7834 - val_loss: 1.4454 - val_calc_accuracy: 0.7848
Epoch 32/40
872/872 - 445s - loss: 0.2017 - calc_accuracy: 0.7885 - val_loss: 1.3188 - val_calc_accuracy: 0.7828
Epoch 33/40
872/872 - 423s - loss: 0.1992 - calc_accuracy: 0.7916 - val_loss: 0.3304 - val_calc_accuracy: 0.7928
Epoch 34/40
872/872 - 429s - loss: 0.1937 - calc_accuracy: 0.7988 - val_loss: 0.7108 - val_calc_accuracy: 0.7920
Epoch 35/40
872/872 - 444s - loss: 0.1893 - calc_accuracy: 0.8035 - val_loss: 1.1914 - val_calc_accuracy: 0.7858
Traceback (most recent call last):
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/train2027.py", line 255, in <module>
    train_model(**arguments)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/train2027.py", line 222, in train_model
    model.save(job_dir + "/model.h5")
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py", line 2002, in save
    signatures, options, save_traces)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/saving/save.py", line 154, in save_model
    model, filepath, overwrite, include_optimizer)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/saving/hdf5_format.py", line 115, in save_model_to_hdf5
    model_metadata = saving_utils.model_metadata(model, include_optimizer)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/saving/saving_utils.py", line 155, in model_metadata
    model_config['config'] = model.get_config()
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/functional.py", line 650, in get_config
    return copy.deepcopy(get_network_config(self))
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/functional.py", line 1349, in get_network_config
    layer_config = serialize_layer_fn(layer)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/utils/generic_utils.py", line 245, in serialize_keras_object
    config = instance.get_config()
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/core.py", line 435, in get_config
    config = super(Conv2DMoE, self).get_config()
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/core.py", line 333, in get_config
    'n_experts_per_filter':n_experts_per_filter,
NameError: name 'n_experts_per_filter' is not defined
Epoch 00035: early stopping

 See logs at ../../cache/conv___03_1040___all_sw_coch_preprocessed_v2_param_v26_augm_v0_cleaned_8000___mod10_inc___2027/logs/