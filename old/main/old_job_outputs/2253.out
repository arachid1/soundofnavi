Category:  coch
Dataset:  all_sw_coch_preprocessed_v2_param_v39_augm_v0_cleaned_8000.pkl
File:  conv.train2253
Description:  new_timeseries
2021-06-25 17:55:06.173008: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
WARNING:tensorflow:From /home/alirachidi/classification_algorithm/trainers/main/models/conv/modules/augmentation.py:19: experimental_run_functions_eagerly (from tensorflow.python.eager.def_function) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.config.run_functions_eagerly` instead of the experimental version.
2021-06-25 17:55:08.703020: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-06-25 17:55:08.703881: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2021-06-25 17:55:08.748646: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:08.749327: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:00:04.0 name: Tesla T4 computeCapability: 7.5
coreClock: 1.59GHz coreCount: 40 deviceMemorySize: 14.75GiB deviceMemoryBandwidth: 298.08GiB/s
2021-06-25 17:55:08.749356: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-06-25 17:55:08.752659: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-06-25 17:55:08.752747: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-06-25 17:55:08.753840: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-06-25 17:55:08.754133: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-06-25 17:55:08.755099: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-06-25 17:55:08.755931: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-06-25 17:55:08.757469: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-06-25 17:55:08.757581: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:08.758328: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:08.759232: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
Tensorflow Version: 2.4.0
Num GPUs Available:  1
-----------------------
Using module: nv/train2253.py
Using train_file: ../../data/datasets/all_sw_coch_preprocessed_v2_param_v39_augm_v0_cleaned_8000.pkl
Job directory: ../../new_cache/conv__2253__06_1754__v39__new_timeseries
Parameters: {'N_CLASSES': 1, 'SR': 8000, 'BATCH_SIZE': 16, 'LR': 0.001, 'SHAPE': [128, 1250], 'LL2_REG': 0, 'WEIGHT_DECAY': 0.001, 'N_EPOCHS': 65, 'FACTOR': 0.5, 'PATIENCE': 6, 'MIN_LR': 1e-07, 'LABEL_SMOOTHING': 0, 'EPSILON': 1e-07, 'ES_PATIENCE': 20, 'OVERSAMPLE': 0, 'MIN_DELTA': 0, 'PARAM': 'v39', 'EPOCH_START': 1, 'JORDAN_DATASET': 1, 'PNEUMONIA_ONLY': 1, 'CLAUSE': 0, 'CUBEROOTING': 1, 'NORMALIZING': 1, 'AUGMENTATION': 0, 'TARGET': 1, 'INITIAL_CHANNELS': 1, 'ADAPTIVE_LR': 1, 'CLASS_WEIGHTS': 1, 'SIX': 0, 'CONCAT': 0, 'TESTING': 0}
Augmentation parameters for audio: {'ADD': 1, 'QUANTITY': 1000, 'WAV_PATH': 'v42,v43'}
Augmentation parameters for spectrograms: {'ADD': 1, 'QUANTITY': 158, 'TIME_MASKING': 1, 'FREQUENCY_MASKING': 1, 'LOUDNESS': 0}
-----------------------
Collecting Variables...
All variables have been collected.
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow_addons/utils/ensure_tf_install.py:68: UserWarning: Tensorflow Addons supports using Python ops for all Tensorflow versions above or equal to 2.2.0 and strictly below 2.3.0 (nightly versions are not supported). 
 The versions of TensorFlow you are currently using is 2.4.0 and is not supported. 
Some things might work, some things might not.
If you were to encounter a bug, do not file an issue.
If you want to make sure you're using a tested and supported configuration, either change the TensorFlow version or the TensorFlow Addons's version. 
You can find the compatibility matrix in TensorFlow Addon's readme:
https://github.com/tensorflow/addons
  UserWarning,
wandb: W&B syncing is set to `offline` in this directory.  Run `wandb online` or set WANDB_MODE=online to enable cloud syncing.
2021-06-25 17:55:13.803923: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-06-25 17:55:13.804163: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:13.804916: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:00:04.0 name: Tesla T4 computeCapability: 7.5
coreClock: 1.59GHz coreCount: 40 deviceMemorySize: 14.75GiB deviceMemoryBandwidth: 298.08GiB/s
2021-06-25 17:55:13.804957: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-06-25 17:55:13.805005: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-06-25 17:55:13.805024: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-06-25 17:55:13.805041: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-06-25 17:55:13.805059: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-06-25 17:55:13.805077: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-06-25 17:55:13.805096: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-06-25 17:55:13.805113: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-06-25 17:55:13.805205: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:13.805887: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:13.806560: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2021-06-25 17:55:13.806605: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-06-25 17:55:14.481480: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2021-06-25 17:55:14.481527: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2021-06-25 17:55:14.481535: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2021-06-25 17:55:14.481795: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:14.482543: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:14.483276: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-06-25 17:55:14.483936: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 13968 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:00:04.0, compute capability: 7.5)
2021-06-25 17:55:16.708493: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:116] None of the MLIR optimization passes are enabled (registered 2)
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
2021-06-25 17:55:16.710118: I tensorflow/core/platform/profile_utils/cpu_utils.cc:112] CPU Frequency: 2299995000 Hz
2021-06-25 17:55:17.065422: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-06-25 17:55:19.179789: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-06-25 17:55:19.617427: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
Pneumonia patients: 148, Non-pneumonia patients: 2873
Pneumonia patients: 51, Non-pneumonia patients: 0
-----------------------
Number of train recordings: 2458 with pneumonia: 158 and non-pneumonia: 2300
Number of val recordings: 614 with pneumonia: 41 and non-pneumonia: 573
-----------------------
Initializing weights...
weights = {0: 0.5257570483814827, 1: 10.20608108108108}
Model: "conv2d"
______________________________________________________________________________________________________________
Layer (type)                        Output Shape            Param #      Connected to                         
==============================================================================================================
input_1 (InputLayer)                [(None, 10, 125, 128, 1 0                                                 
______________________________________________________________________________________________________________
batch_normalization (BatchNormaliza (None, 10, 125, 128, 1) 4            input_1[0][0]                        
______________________________________________________________________________________________________________
time_distributed (TimeDistributed)  (None, 10, 125, 128, 16 32           batch_normalization[0][0]            
______________________________________________________________________________________________________________
time_distributed_2 (TimeDistributed (None, 10, 125, 128, 16 32           batch_normalization[0][0]            
______________________________________________________________________________________________________________
time_distributed_4 (TimeDistributed (None, 10, 125, 128, 1) 0            batch_normalization[0][0]            
______________________________________________________________________________________________________________
time_distributed_1 (TimeDistributed (None, 10, 125, 128, 16 2320         time_distributed[0][0]               
______________________________________________________________________________________________________________
time_distributed_3 (TimeDistributed (None, 10, 125, 128, 16 6416         time_distributed_2[0][0]             
______________________________________________________________________________________________________________
time_distributed_5 (TimeDistributed (None, 10, 125, 128, 16 32           time_distributed_4[0][0]             
______________________________________________________________________________________________________________
concatenate (Concatenate)           (None, 10, 125, 128, 48 0            time_distributed_1[0][0]             
                                                                         time_distributed_3[0][0]             
                                                                         time_distributed_5[0][0]             
______________________________________________________________________________________________________________
time_distributed_6 (TimeDistributed (None, 10, 63, 64, 48)  0            concatenate[0][0]                    
______________________________________________________________________________________________________________
batch_normalization_1 (BatchNormali (None, 10, 63, 64, 48)  192          time_distributed_6[0][0]             
______________________________________________________________________________________________________________
time_distributed_7 (TimeDistributed (None, 10, 63, 64, 128) 55424        batch_normalization_1[0][0]          
______________________________________________________________________________________________________________
time_distributed_8 (TimeDistributed (None, 10, 63, 64, 128) 3402         time_distributed_7[0][0]             
______________________________________________________________________________________________________________
time_distributed_9 (TimeDistributed (None, 10, 32, 32, 128) 0            time_distributed_8[0][0]             
______________________________________________________________________________________________________________
batch_normalization_2 (BatchNormali (None, 10, 32, 32, 128) 512          time_distributed_9[0][0]             
______________________________________________________________________________________________________________
time_distributed_10 (TimeDistribute (None, 10, 128)         0            batch_normalization_2[0][0]          
______________________________________________________________________________________________________________
bidirectional (Bidirectional)       (None, 10, 256)         263168       time_distributed_10[0][0]            
______________________________________________________________________________________________________________
bidirectional_1 (Bidirectional)     (None, 10, 256)         394240       bidirectional[0][0]                  
______________________________________________________________________________________________________________
dense (Dense)                       (None, 10, 128)         32896        bidirectional_1[0][0]                
______________________________________________________________________________________________________________
dense_1 (Dense)                     (None, 10, 1)           129          dense[0][0]                          
______________________________________________________________________________________________________________
flatten (Flatten)                   (None, 10)              0            dense_1[0][0]                        
______________________________________________________________________________________________________________
dense_2 (Dense)                     (None, 1)               11           flatten[0][0]                        
==============================================================================================================
Total params: 758,810
Trainable params: 758,456
Non-trainable params: 354
______________________________________________________________________________________________________________
Epoch 1/65
154/154 - 91s - loss: 0.6571 - accuracy: 0.5806 - val_loss: 0.3308 - val_accuracy: 0.9332
Confusion matrix: 
 [[573   0]
 [ 41   0]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/sklearn/metrics/_classification.py:1272: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
Normalized Confusion matrix: 
 [[1. 0.]
 [1. 0.]]
Validation f1: 0.00
Validation accuracy: 93.32
Validation recall: 0.00
Validation precision: 0.00
Validation AUC: 0.09330685243110426
Validation class accuracies: [1.0, 0.0]
The validation tracker metric at 0 hasn't increased by 0 in 1 epochs
Epoch 2/65
154/154 - 87s - loss: 0.5903 - accuracy: 0.6082 - val_loss: 0.3298 - val_accuracy: 0.9332
Confusion matrix: 
 [[573   0]
 [ 41   0]]
Normalized Confusion matrix: 
 [[1. 0.]
 [1. 0.]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/sklearn/metrics/_classification.py:1272: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
Validation f1: 0.00
Validation accuracy: 93.32
Validation recall: 0.00
Validation precision: 0.00
Validation AUC: 0.08263162668612625
Validation class accuracies: [1.0, 0.0]
The validation tracker metric at 0 hasn't increased by 0 in 2 epochs
Epoch 3/65
154/154 - 86s - loss: 0.5449 - accuracy: 0.7242 - val_loss: 0.6157 - val_accuracy: 0.9251
Confusion matrix: 
 [[548  25]
 [ 21  20]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.956 0.044]
 [0.512 0.488]]
Validation f1: 46.51
Validation accuracy: 92.51
Validation recall: 48.78
Validation precision: 44.44
Validation AUC: 0.3274058834717784
Validation class accuracies: [0.956369982547993, 0.4878048780487805]
Saving model...
Epoch 4/65
154/154 - 88s - loss: 0.5650 - accuracy: 0.6570 - val_loss: 0.6684 - val_accuracy: 0.6450
Confusion matrix: 
 [[371 202]
 [ 16  25]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.647 0.353]
 [0.39  0.61 ]]
Validation f1: 18.66
Validation accuracy: 64.50
Validation recall: 60.98
Validation precision: 11.01
Validation AUC: 0.1514137403323277
Validation class accuracies: [0.6474694589877836, 0.6097560975609756]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 1 epochs
Epoch 5/65
154/154 - 87s - loss: 0.5570 - accuracy: 0.5504 - val_loss: 0.8665 - val_accuracy: 0.3322
Confusion matrix: 
 [[163 410]
 [  0  41]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.284 0.716]
 [0.    1.   ]]
Validation f1: 16.67
Validation accuracy: 33.22
Validation recall: 100.00
Validation precision: 9.09
Validation AUC: 0.13681786934346102
Validation class accuracies: [0.2844677137870855, 1.0]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 2 epochs
Epoch 6/65
154/154 - 87s - loss: 0.5223 - accuracy: 0.6989 - val_loss: 0.4973 - val_accuracy: 0.8616
Confusion matrix: 
 [[496  77]
 [  8  33]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.866 0.134]
 [0.195 0.805]]
Validation f1: 43.71
Validation accuracy: 86.16
Validation recall: 80.49
Validation precision: 30.00
Validation AUC: 0.26813770249854285
Validation class accuracies: [0.8656195462478184, 0.8048780487804879]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 3 epochs
Epoch 7/65
154/154 - 87s - loss: 0.4933 - accuracy: 0.8507 - val_loss: 0.9795 - val_accuracy: 0.4821
Confusion matrix: 
 [[255 318]
 [  0  41]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.445 0.555]
 [0.    1.   ]]
Validation f1: 20.50
Validation accuracy: 48.21
Validation recall: 100.00
Validation precision: 11.42
Validation AUC: 0.20182831396960063
Validation class accuracies: [0.44502617801047123, 1.0]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 4 epochs
Epoch 8/65
154/154 - 87s - loss: 0.4790 - accuracy: 0.7705 - val_loss: 0.5615 - val_accuracy: 0.7866
Confusion matrix: 
 [[447 126]
 [  5  36]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.78  0.22 ]
 [0.122 0.878]]
Validation f1: 35.47
Validation accuracy: 78.66
Validation recall: 87.80
Validation precision: 22.22
Validation AUC: 0.23029239647609107
Validation class accuracies: [0.7801047120418848, 0.8780487804878049]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 5 epochs
Epoch 9/65
154/154 - 88s - loss: 0.5116 - accuracy: 0.7099 - val_loss: 0.4800 - val_accuracy: 0.8225
Confusion matrix: 
 [[468 105]
 [  4  37]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.817 0.183]
 [0.098 0.902]]
Validation f1: 40.44
Validation accuracy: 82.25
Validation recall: 90.24
Validation precision: 26.06
Validation AUC: 0.29560750171380745
Validation class accuracies: [0.8167539267015707, 0.9024390243902439]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 6 epochs
Lr has been adjusted to 0.0005000000237487257
Epoch 10/65
154/154 - 87s - loss: 0.4882 - accuracy: 0.7648 - val_loss: 0.5754 - val_accuracy: 0.8208
Confusion matrix: 
 [[467 106]
 [  4  37]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.815 0.185]
 [0.098 0.902]]
Validation f1: 40.22
Validation accuracy: 82.08
Validation recall: 90.24
Validation precision: 25.87
Validation AUC: 0.3257498708729775
Validation class accuracies: [0.8150087260034904, 0.9024390243902439]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 7 epochs
Epoch 11/65
154/154 - 87s - loss: 0.4332 - accuracy: 0.8173 - val_loss: 0.5807 - val_accuracy: 0.8322
Confusion matrix: 
 [[473 100]
 [  3  38]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.825 0.175]
 [0.073 0.927]]
Validation f1: 42.46
Validation accuracy: 83.22
Validation recall: 92.68
Validation precision: 27.54
Validation AUC: 0.2763433439638667
Validation class accuracies: [0.8254799301919721, 0.926829268292683]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 8 epochs
Epoch 12/65
154/154 - 87s - loss: 0.4166 - accuracy: 0.8291 - val_loss: 0.5064 - val_accuracy: 0.8420
Confusion matrix: 
 [[480  93]
 [  4  37]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.838 0.162]
 [0.098 0.902]]
Validation f1: 43.27
Validation accuracy: 84.20
Validation recall: 90.24
Validation precision: 28.46
Validation AUC: 0.26378171454390825
Validation class accuracies: [0.837696335078534, 0.9024390243902439]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 9 epochs
Epoch 13/65
154/154 - 88s - loss: 0.4095 - accuracy: 0.8487 - val_loss: 0.5264 - val_accuracy: 0.8306
Confusion matrix: 
 [[473 100]
 [  4  37]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.825 0.175]
 [0.098 0.902]]
Validation f1: 41.57
Validation accuracy: 83.06
Validation recall: 90.24
Validation precision: 27.01
Validation AUC: 0.29550787492951414
Validation class accuracies: [0.8254799301919721, 0.9024390243902439]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 10 epochs
Epoch 14/65
154/154 - 87s - loss: 0.3835 - accuracy: 0.8694 - val_loss: 0.5196 - val_accuracy: 0.8371
Confusion matrix: 
 [[477  96]
 [  4  37]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.832 0.168]
 [0.098 0.902]]
Validation f1: 42.53
Validation accuracy: 83.71
Validation recall: 90.24
Validation precision: 27.82
Validation AUC: 0.3207040794518439
Validation class accuracies: [0.8324607329842932, 0.9024390243902439]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 11 epochs
Epoch 15/65
154/154 - 87s - loss: 0.4029 - accuracy: 0.8674 - val_loss: 0.5540 - val_accuracy: 0.8143
Confusion matrix: 
 [[465 108]
 [  6  35]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.812 0.188]
 [0.146 0.854]]
Validation f1: 38.04
Validation accuracy: 81.43
Validation recall: 85.37
Validation precision: 24.48
Validation AUC: 0.24799869639817518
Validation class accuracies: [0.8115183246073299, 0.8536585365853658]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 12 epochs
Lr has been adjusted to 0.0002500000118743628
Epoch 16/65
154/154 - 87s - loss: 0.4267 - accuracy: 0.8731 - val_loss: 0.5485 - val_accuracy: 0.8306
Confusion matrix: 
 [[475  98]
 [  6  35]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.829 0.171]
 [0.146 0.854]]
Validation f1: 40.23
Validation accuracy: 83.06
Validation recall: 85.37
Validation precision: 26.32
Validation AUC: 0.24341064457627476
Validation class accuracies: [0.8289703315881326, 0.8536585365853658]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 13 epochs
Epoch 17/65
154/154 - 89s - loss: 0.4306 - accuracy: 0.8784 - val_loss: 0.5858 - val_accuracy: 0.8225
Confusion matrix: 
 [[469 104]
 [  5  36]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.818 0.182]
 [0.122 0.878]]
Validation f1: 39.78
Validation accuracy: 82.25
Validation recall: 87.80
Validation precision: 25.71
Validation AUC: 0.23473572990632385
Validation class accuracies: [0.8184991273996509, 0.8780487804878049]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 14 epochs
Epoch 18/65
154/154 - 87s - loss: 0.4250 - accuracy: 0.8666 - val_loss: 0.5167 - val_accuracy: 0.8436
Confusion matrix: 
 [[483  90]
 [  6  35]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.843 0.157]
 [0.146 0.854]]
Validation f1: 42.17
Validation accuracy: 84.36
Validation recall: 85.37
Validation precision: 28.00
Validation AUC: 0.26006673487904625
Validation class accuracies: [0.8429319371727748, 0.8536585365853658]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 15 epochs
Epoch 19/65
154/154 - 87s - loss: 0.4042 - accuracy: 0.8792 - val_loss: 0.5343 - val_accuracy: 0.8355
Confusion matrix: 
 [[478  95]
 [  6  35]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.834 0.166]
 [0.146 0.854]]
Validation f1: 40.94
Validation accuracy: 83.55
Validation recall: 85.37
Validation precision: 26.92
Validation AUC: 0.25397037651038784
Validation class accuracies: [0.8342059336823735, 0.8536585365853658]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 16 epochs
Epoch 20/65
154/154 - 87s - loss: 0.4074 - accuracy: 0.8784 - val_loss: 0.5458 - val_accuracy: 0.8371
Confusion matrix: 
 [[479  94]
 [  6  35]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.836 0.164]
 [0.146 0.854]]
Validation f1: 41.18
Validation accuracy: 83.71
Validation recall: 85.37
Validation precision: 27.13
Validation AUC: 0.3008101046579046
Validation class accuracies: [0.8359511343804538, 0.8536585365853658]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 17 epochs
Epoch 21/65
154/154 - 87s - loss: 0.4017 - accuracy: 0.8841 - val_loss: 0.5573 - val_accuracy: 0.8469
Confusion matrix: 
 [[485  88]
 [  6  35]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.846 0.154]
 [0.146 0.854]]
Validation f1: 42.68
Validation accuracy: 84.69
Validation recall: 85.37
Validation precision: 28.46
Validation AUC: 0.2549866144340347
Validation class accuracies: [0.8464223385689355, 0.8536585365853658]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 18 epochs
Lr has been adjusted to 0.0001250000059371814
Epoch 22/65
154/154 - 88s - loss: 0.3989 - accuracy: 0.8922 - val_loss: 0.5366 - val_accuracy: 0.8502
Confusion matrix: 
 [[487  86]
 [  6  35]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.85  0.15 ]
 [0.146 0.854]]
Validation f1: 43.21
Validation accuracy: 85.02
Validation recall: 85.37
Validation precision: 28.93
Validation AUC: 0.25481882899516317
Validation class accuracies: [0.849912739965096, 0.8536585365853658]
The validation tracker metric at 0.46511627906976744 hasn't increased by 0 in 19 epochs
Epoch 23/65
154/154 - 87s - loss: 0.4054 - accuracy: 0.8828 - val_loss: 0.5919 - val_accuracy: 0.8306
Confusion matrix: 
 [[474  99]
 [  5  36]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Normalized Confusion matrix: 
 [[0.827 0.173]
 [0.122 0.878]]
Validation f1: 40.91
Validation accuracy: 83.06
Validation recall: 87.80
Validation precision: 26.67
Validation AUC: 0.24371734939344097
Validation class accuracies: [0.8272251308900523, 0.8780487804878049]

The metrics for job 0 with the best target metric are: 
Best cm: [[548  25]
 [ 21  20]]
Best normalized cm: [[0.956 0.044]
 [0.512 0.488]]
Best f1: 0.47
Best accuracy: 0.93
Best recall: 0.49
Best precision: 0.44
Best AUC: 0.33
Best class accuracies: [0.956369982547993, 0.4878048780487805]
Best epoch: 3
The number of epochs since last 1% equals the patience
../../new_cache/conv__2253__06_1754__v39__new_timeseries/0/icbhi_213_1p3_Pl_mc_AKGC417L_3_label_0_pred_0.png, [[0.268]]
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/data/ops/dataset_ops.py:3504: UserWarning: Even though the tf.config.experimental_run_functions_eagerly option is set, this option does not apply to tf.data functions. tf.data functions are still traced and executed as graphs.
  "Even though the tf.config.experimental_run_functions_eagerly "
Traceback (most recent call last):
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/train2253.py", line 383, in <module>
    train_model(train_file, job_dir, params, wav_params, spec_params, conv2d, job_count=0)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/train2253.py", line 325, in train_model
    callbacks=[metrics_callback]
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/wandb/integration/keras/keras.py", line 124, in new_v2
    return old_v2(*args, **kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py", line 1154, in fit
    callbacks.on_train_end(logs=training_logs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/callbacks.py", line 532, in on_train_end
    callback.on_train_end(numpy_logs)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/modules/callbacks.py", line 143, in on_train_end
    visualize_spectrogram(spec_to_vis, self.sr, name)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/modules/helpers.py", line 64, in visualize_spectrogram
    cmap="coolwarm"
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/librosa/display.py", line 848, in specshow
    out = axes.pcolormesh(x_coords, y_coords, data, **kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/matplotlib/__init__.py", line 1599, in inner
    return func(ax, *map(sanitize_sequence, args), **kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/matplotlib/axes/_axes.py", line 6165, in pcolormesh
    X, Y, C = self._pcolorargs('pcolormesh', *args, allmatch=allmatch)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/matplotlib/axes/_axes.py", line 5734, in _pcolorargs
    numRows, numCols = C.shape
ValueError: too many values to unpack (expected 2)
wandb: Waiting for W&B process to finish, PID 14061
wandb: Program failed with code 1. 
wandb: Find user logs for this run at: /home/alirachidi/classification_algorithm/trainers/main/wandb/offline-run-20210625_175508-3pcal83r/logs/debug.log
wandb: Find internal logs for this run at: /home/alirachidi/classification_algorithm/trainers/main/wandb/offline-run-20210625_175508-3pcal83r/logs/debug-internal.log
wandb: Run summary:
wandb:       train_accuracy 0.88283
wandb:         val_accuracy 0.83062
wandb:             _runtime 2251
wandb:           _timestamp 1624645960
wandb:                _step 163
wandb:           train_loss 0.40539
wandb:             val_loss 0.59188
wandb:           val_recall 0.87805
wandb:        val_precision 0.26667
wandb:               val_f1 0.40909
wandb:              val_auc 0.24372
wandb:                   lr 0.00013
wandb:          best_val_f1 0.46512
wandb:    best_val_accuracy 0.92508
wandb:   best_val_precision 0.44444
wandb:      best_val_recall 0.4878
wandb:             best_auc 0.32741
wandb:           best_epoch 3
wandb: Run history:
wandb:   train_accuracy ▂▂▅▃▁▄▇▆▄▅▆▇▇█▇██▇█████
wandb:     val_accuracy ███▅▁▇▃▆▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇
wandb:         _runtime ▁▁▁▁▂▂▂▂▂▂▃▃▃▃▄▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:       _timestamp ▁▁▁▁▂▂▂▂▂▂▃▃▃▃▄▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:            _step ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:       train_loss █▆▅▆▅▅▄▃▄▄▂▂▂▁▁▂▂▂▂▂▁▁▂
wandb:         val_loss ▁▁▄▅▇▃█▃▃▄▄▃▃▃▃▃▄▃▃▃▃▃▄
wandb:       val_recall ▁▁▄▅█▇█▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇
wandb:    val_precision ▁▁█▃▂▆▃▅▅▅▅▅▅▅▅▅▅▅▅▅▅▆▅
wandb:           val_f1 ▁▁█▄▄█▄▆▇▇▇█▇▇▇▇▇▇▇▇▇█▇
wandb:          val_auc ▁▁█▃▃▆▄▅▇█▇▆▇█▆▆▅▆▆▇▆▆▆
wandb:               lr █████████▄▄▄▄▄▄▂▂▂▂▂▂▁▁
wandb: 
wandb: You can sync this run to the cloud by running:
wandb: wandb sync /home/alirachidi/classification_algorithm/trainers/main/wandb/offline-run-20210625_175508-3pcal83r


 See logs at ../../new_cache/conv__2253__06_1754__v39__new_timeseries/logs/