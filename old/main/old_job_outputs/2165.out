Category:  coch
Dataset:  all_sw_coch_preprocessed_v2_param_v29_augm_v0_cleaned_8000.pkl
File:  conv.train2165
Description:  new_lstmdense
2021-05-27 22:46:48.317164: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-05-27 22:46:53.443309: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-05-27 22:46:53.445140: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2021-05-27 22:46:53.529862: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:46:53.530809: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:00:05.0 name: Tesla T4 computeCapability: 7.5
coreClock: 1.59GHz coreCount: 40 deviceMemorySize: 14.75GiB deviceMemoryBandwidth: 298.08GiB/s
2021-05-27 22:46:53.530864: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-05-27 22:46:53.546459: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-05-27 22:46:53.546721: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-05-27 22:46:53.550087: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-05-27 22:46:53.554174: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-05-27 22:46:53.557580: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-05-27 22:46:53.574897: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-05-27 22:46:53.576939: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-05-27 22:46:53.577493: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:46:53.579212: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:46:53.580402: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
wandb: Currently logged in as: arachid1 (use `wandb login --relogin` to force relogin)
Tensorflow Version: 2.4.0
Num GPUs Available:  1
-----------------------
Using module located at /main/models/conv/train2165.py
Using train_file located at ../../data/datasets/all_sw_coch_preprocessed_v2_param_v29_augm_v0_cleaned_8000.pkl
Using logs_path located at ../../new_cache/conv__2165__05_2238__v29__new_lstmdense/logs/
-----------------------
Collecting Variables...
Model Parameters: {'N_CLASSES': 1, 'SR': 8000, 'BATCH_SIZE': 16, 'LR': 0.001, 'SHAPE': (1250, 128), 'WEIGHT_DECAY': 0.001, 'LL2_REG': 0, 'EPSILON': 1e-07, 'LABEL_SMOOTHING': 0}
Learning Rate Parameters: {'factor': 0.25, 'patience': 4, 'min_lr': 1e-10}
Early Stopping Patience and Delta: 25, 0%
Six: False and Concat: False
-----------------------
wandb: wandb version 0.10.31 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.10.30
wandb: Syncing run train2165
wandb: ⭐️ View project at https://wandb.ai/arachid1/tensorboard-integration
wandb: 🚀 View run at https://wandb.ai/arachid1/tensorboard-integration/runs/2xp08pho
wandb: Run data is saved locally in /home/alirachidi/classification_algorithm/trainers/main/wandb/run-20210527_224653-2xp08pho
wandb: Run `wandb offline` to turn off syncing.
2021-05-27 22:47:00.296578: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-05-27 22:47:00.297187: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:47:00.298422: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:00:05.0 name: Tesla T4 computeCapability: 7.5
coreClock: 1.59GHz coreCount: 40 deviceMemorySize: 14.75GiB deviceMemoryBandwidth: 298.08GiB/s
2021-05-27 22:47:00.298527: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-05-27 22:47:00.298673: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-05-27 22:47:00.298705: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-05-27 22:47:00.298738: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-05-27 22:47:00.298771: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-05-27 22:47:00.298803: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-05-27 22:47:00.298834: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-05-27 22:47:00.298865: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-05-27 22:47:00.299056: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:47:00.300338: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:47:00.301396: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2021-05-27 22:47:00.301524: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-05-27 22:47:01.614838: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2021-05-27 22:47:01.614937: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2021-05-27 22:47:01.614961: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2021-05-27 22:47:01.615616: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:47:01.617141: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:47:01.618561: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-27 22:47:01.619687: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 13968 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:00:05.0, compute capability: 7.5)
2021-05-27 22:48:10.423408: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:116] None of the MLIR optimization passes are enabled (registered 2)
2021-05-27 22:48:10.429407: I tensorflow/core/platform/profile_utils/cpu_utils.cc:112] CPU Frequency: 2299995000 Hz
2021-05-27 22:48:19.737626: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-05-27 22:48:20.966375: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-05-27 22:48:20.980516: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8

Original number of folders: 453
With concat = False and six = False, size of training set: 4196...
...and size of validation set: 1088
Initializing weights...
weights = {0: 0.7018518518518518, 1: 1.738532110091743}
Model: "conv2d"
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
input_1 (InputLayer)            [(None, 1250, 128)]  0                                            
__________________________________________________________________________________________________
layer_normalization (LayerNorma (None, 1250, 128)    256         input_1[0][0]                    
__________________________________________________________________________________________________
time_distributed (TimeDistribut (None, 1250, 128)    0           layer_normalization[0][0]        
__________________________________________________________________________________________________
time_distributed_1 (TimeDistrib (None, 1250, 64)     8256        time_distributed[0][0]           
__________________________________________________________________________________________________
bidirectional (Bidirectional)   (None, 1250, 64)     24832       time_distributed_1[0][0]         
__________________________________________________________________________________________________
concatenate (Concatenate)       (None, 1250, 128)    0           time_distributed_1[0][0]         
                                                                 bidirectional[0][0]              
__________________________________________________________________________________________________
time_distributed_2 (TimeDistrib (None, 1250, 32)     4128        concatenate[0][0]                
__________________________________________________________________________________________________
bidirectional_1 (Bidirectional) (None, 1250, 32)     6272        time_distributed_2[0][0]         
__________________________________________________________________________________________________
concatenate_1 (Concatenate)     (None, 1250, 64)     0           time_distributed_2[0][0]         
                                                                 bidirectional_1[0][0]            
__________________________________________________________________________________________________
dense_2 (Dense)                 (None, 1250, 64)     4160        concatenate_1[0][0]              
__________________________________________________________________________________________________
average_pooling1d (AveragePooli (None, 625, 64)      0           dense_2[0][0]                    
__________________________________________________________________________________________________
flatten (Flatten)               (None, 40000)        0           average_pooling1d[0][0]          
__________________________________________________________________________________________________
dropout (Dropout)               (None, 40000)        0           flatten[0][0]                    
__________________________________________________________________________________________________
dense_3 (Dense)                 (None, 64)           2560064     dropout[0][0]                    
__________________________________________________________________________________________________
dense_4 (Dense)                 (None, 1)            65          dense_3[0][0]                    
==================================================================================================
Total params: 2,608,033
Trainable params: 2,608,033
Non-trainable params: 0
__________________________________________________________________________________________________
Epoch 1/80
263/263 - 145s - loss: 0.7062 - accuracy: 0.5531 - val_loss: 0.6659 - val_accuracy: 0.6039
Confusion matrix: 
 [[553 317]
 [114 104]]
Validation f1: 32.55
Validation accuracy: 60.39
Validation recall: 47.71
Validation precision: 24.70
Validation AUC: 0.4163461273774848
Validation class accuracies: [0.635632183908046, 0.47706422018348627]
TARGET: 1
target metric(test f1): 0.3255086071987481
inside not defaulting
Saving model...
Epoch 2/80
263/263 - 125s - loss: 0.6732 - accuracy: 0.6299 - val_loss: 0.6286 - val_accuracy: 0.6195
Confusion matrix: 
 [[569 301]
 [113 105]]
Validation f1: 33.65
Validation accuracy: 61.95
Validation recall: 48.17
Validation precision: 25.86
Validation AUC: 0.19027361216169
Validation class accuracies: [0.6540229885057471, 0.481651376146789]
TARGET: 1
target metric(test f1): 0.33653846153846156
inside not defaulting
Saving model...
Epoch 3/80
263/263 - 101s - loss: 0.6373 - accuracy: 0.7009 - val_loss: 0.5992 - val_accuracy: 0.6756
Confusion matrix: 
 [[676 194]
 [159  59]]
Validation f1: 25.05
Validation accuracy: 67.56
Validation recall: 27.06
Validation precision: 23.32
Validation AUC: 0.24241684470892305
Validation class accuracies: [0.7770114942528735, 0.2706422018348624]
TARGET: 1
target metric(test f1): 0.2505307855626327
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 1 epochs
Epoch 4/80
263/263 - 100s - loss: 0.5573 - accuracy: 0.7750 - val_loss: 0.7991 - val_accuracy: 0.4559
Confusion matrix: 
 [[358 512]
 [ 80 138]]
Validation f1: 31.80
Validation accuracy: 45.59
Validation recall: 63.30
Validation precision: 21.23
Validation AUC: 0.23562083544163856
Validation class accuracies: [0.4114942528735632, 0.6330275229357798]
TARGET: 1
target metric(test f1): 0.31797235023041476
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 2 epochs
Epoch 5/80
263/263 - 100s - loss: 0.4149 - accuracy: 0.8580 - val_loss: 0.8693 - val_accuracy: 0.4991
Confusion matrix: 
 [[420 450]
 [ 95 123]]
Validation f1: 31.10
Validation accuracy: 49.91
Validation recall: 56.42
Validation precision: 21.47
Validation AUC: 0.239353279041505
Validation class accuracies: [0.4827586206896552, 0.5642201834862385]
TARGET: 1
target metric(test f1): 0.3109987357774968
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 3 epochs
Epoch 6/80
263/263 - 99s - loss: 0.2435 - accuracy: 0.9423 - val_loss: 0.8491 - val_accuracy: 0.5662
Confusion matrix: 
 [[522 348]
 [124  94]]
Validation f1: 28.48
Validation accuracy: 56.62
Validation recall: 43.12
Validation precision: 21.27
Validation AUC: 0.22517759080429187
Validation class accuracies: [0.6, 0.43119266055045874]
TARGET: 1
target metric(test f1): 0.28484848484848485
inside not defaulting
Lr has been adjusted to 0.0002500000118743628
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 4 epochs
Epoch 7/80
263/263 - 99s - loss: 0.1520 - accuracy: 0.9795 - val_loss: 0.7682 - val_accuracy: 0.6728
Confusion matrix: 
 [[672 198]
 [158  60]]
Validation f1: 25.21
Validation accuracy: 67.28
Validation recall: 27.52
Validation precision: 23.26
Validation AUC: 0.22473352216118844
Validation class accuracies: [0.7724137931034483, 0.27522935779816515]
TARGET: 1
target metric(test f1): 0.25210084033613445
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 5 epochs
Epoch 8/80
263/263 - 99s - loss: 0.1332 - accuracy: 0.9867 - val_loss: 0.7848 - val_accuracy: 0.6783
Confusion matrix: 
 [[687 183]
 [167  51]]
Validation f1: 22.57
Validation accuracy: 67.83
Validation recall: 23.39
Validation precision: 21.79
Validation AUC: 0.22015304351234374
Validation class accuracies: [0.7896551724137931, 0.23394495412844038]
TARGET: 1
target metric(test f1): 0.22566371681415928
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 6 epochs
Epoch 9/80
263/263 - 100s - loss: 0.1224 - accuracy: 0.9890 - val_loss: 0.8020 - val_accuracy: 0.6581
Confusion matrix: 
 [[653 217]
 [155  63]]
Validation f1: 25.30
Validation accuracy: 65.81
Validation recall: 28.90
Validation precision: 22.50
Validation AUC: 0.22142813772594658
Validation class accuracies: [0.7505747126436781, 0.2889908256880734]
TARGET: 1
target metric(test f1): 0.25301204819277107
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 7 epochs
Epoch 10/80
263/263 - 100s - loss: 0.1157 - accuracy: 0.9905 - val_loss: 0.7917 - val_accuracy: 0.6912
Confusion matrix: 
 [[704 166]
 [170  48]]
Validation f1: 22.22
Validation accuracy: 69.12
Validation recall: 22.02
Validation precision: 22.43
Validation AUC: 0.22276915106434414
Validation class accuracies: [0.8091954022988506, 0.22018348623853212]
TARGET: 1
target metric(test f1): 0.2222222222222222
inside not defaulting
Lr has been adjusted to 6.25000029685907e-05
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 8 epochs
Epoch 11/80
263/263 - 99s - loss: 0.1090 - accuracy: 0.9924 - val_loss: 0.8016 - val_accuracy: 0.6893
Confusion matrix: 
 [[703 167]
 [171  47]]
Validation f1: 21.76
Validation accuracy: 68.93
Validation recall: 21.56
Validation precision: 21.96
Validation AUC: 0.22163855643461533
Validation class accuracies: [0.8080459770114943, 0.21559633027522937]
TARGET: 1
target metric(test f1): 0.2175925925925926
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 9 epochs
Epoch 12/80
263/263 - 98s - loss: 0.1067 - accuracy: 0.9921 - val_loss: 0.8055 - val_accuracy: 0.6801
Confusion matrix: 
 [[691 179]
 [169  49]]
Validation f1: 21.97
Validation accuracy: 68.01
Validation recall: 22.48
Validation precision: 21.49
Validation AUC: 0.22069018175247349
Validation class accuracies: [0.7942528735632184, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.21973094170403587
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 10 epochs
Epoch 13/80
263/263 - 98s - loss: 0.1055 - accuracy: 0.9912 - val_loss: 0.8097 - val_accuracy: 0.6811
Confusion matrix: 
 [[689 181]
 [166  52]]
Validation f1: 23.06
Validation accuracy: 68.11
Validation recall: 23.85
Validation precision: 22.32
Validation AUC: 0.2217509179717206
Validation class accuracies: [0.7919540229885057, 0.23853211009174313]
TARGET: 1
target metric(test f1): 0.23059866962305986
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 11 epochs
Epoch 14/80
263/263 - 101s - loss: 0.1044 - accuracy: 0.9926 - val_loss: 0.8094 - val_accuracy: 0.6838
Confusion matrix: 
 [[694 176]
 [168  50]]
Validation f1: 22.52
Validation accuracy: 68.38
Validation recall: 22.94
Validation precision: 22.12
Validation AUC: 0.22061991975797138
Validation class accuracies: [0.7977011494252874, 0.22935779816513763]
TARGET: 1
target metric(test f1): 0.22522522522522523
inside not defaulting
Lr has been adjusted to 1.5625000742147677e-05
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 12 epochs
Epoch 15/80
263/263 - 102s - loss: 0.1022 - accuracy: 0.9919 - val_loss: 0.8099 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.22033470912702924
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 13 epochs
Epoch 16/80
263/263 - 100s - loss: 0.1025 - accuracy: 0.9914 - val_loss: 0.8094 - val_accuracy: 0.6838
Confusion matrix: 
 [[696 174]
 [170  48]]
Validation f1: 21.82
Validation accuracy: 68.38
Validation recall: 22.02
Validation precision: 21.62
Validation AUC: 0.22017434519608514
Validation class accuracies: [0.8, 0.22018348623853212]
TARGET: 1
target metric(test f1): 0.21818181818181817
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 14 epochs
Epoch 17/80
263/263 - 99s - loss: 0.1026 - accuracy: 0.9912 - val_loss: 0.8117 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.22022693913613553
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 15 epochs
Epoch 18/80
263/263 - 101s - loss: 0.1021 - accuracy: 0.9921 - val_loss: 0.8132 - val_accuracy: 0.6820
Confusion matrix: 
 [[693 177]
 [169  49]]
Validation f1: 22.07
Validation accuracy: 68.20
Validation recall: 22.48
Validation precision: 21.68
Validation AUC: 0.22025497364830018
Validation class accuracies: [0.7965517241379311, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22072072072072071
inside not defaulting
Lr has been adjusted to 3.906250185536919e-06
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 16 epochs
Epoch 19/80
263/263 - 100s - loss: 0.1014 - accuracy: 0.9926 - val_loss: 0.8115 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.22016824876885338
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 17 epochs
Epoch 20/80
263/263 - 101s - loss: 0.1008 - accuracy: 0.9929 - val_loss: 0.8110 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.22014808591884505
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 18 epochs
Epoch 21/80
263/263 - 101s - loss: 0.1008 - accuracy: 0.9926 - val_loss: 0.8109 - val_accuracy: 0.6838
Confusion matrix: 
 [[696 174]
 [170  48]]
Validation f1: 21.82
Validation accuracy: 68.38
Validation recall: 22.02
Validation precision: 21.62
Validation AUC: 0.22008535332232199
Validation class accuracies: [0.8, 0.22018348623853212]
TARGET: 1
target metric(test f1): 0.21818181818181817
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 19 epochs
Epoch 22/80
263/263 - 101s - loss: 0.1010 - accuracy: 0.9938 - val_loss: 0.8116 - val_accuracy: 0.6847
Confusion matrix: 
 [[696 174]
 [169  49]]
Validation f1: 22.22
Validation accuracy: 68.47
Validation recall: 22.48
Validation precision: 21.97
Validation AUC: 0.22008359081557038
Validation class accuracies: [0.8, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.2222222222222222
inside not defaulting
Lr has been adjusted to 9.765625463842298e-07
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 20 epochs
Epoch 23/80
263/263 - 86s - loss: 0.1009 - accuracy: 0.9933 - val_loss: 0.8116 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.22007932943107486
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 21 epochs
Epoch 24/80
263/263 - 72s - loss: 0.1009 - accuracy: 0.9933 - val_loss: 0.8116 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.22008775426096996
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 22 epochs
Epoch 25/80
263/263 - 71s - loss: 0.1013 - accuracy: 0.9924 - val_loss: 0.8118 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.22007895362310137
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 23 epochs
Epoch 26/80
263/263 - 71s - loss: 0.1005 - accuracy: 0.9936 - val_loss: 0.8118 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.2200721915877485
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
Lr has been adjusted to 2.4414063659605745e-07
The validation tracker metric at 0.33653846153846156 hasn't increased by 0 in 24 epochs
Epoch 27/80
263/263 - 71s - loss: 0.1018 - accuracy: 0.9924 - val_loss: 0.8118 - val_accuracy: 0.6838
Confusion matrix: 
 [[695 175]
 [169  49]]
Validation f1: 22.17
Validation accuracy: 68.38
Validation recall: 22.48
Validation precision: 21.88
Validation AUC: 0.22007943088601364
Validation class accuracies: [0.7988505747126436, 0.22477064220183487]

The metrics for the epoch with the best target metric are: 
Best cm: [[569 301]
 [113 105]]
Best f1: 0.33653846153846156
Best accuracy: 0.6194852941176471
Best recall: 0.481651376146789
Best precision: 0.25862068965517243
Best AUC: 0.19027361216169
Best epoch: 2
TARGET: 1
target metric(test f1): 0.22171945701357468
inside not defaulting
The number of epochs since last 1% equals the patience

Starting the Bangladesh analysis...
Epoch: 80
Starting...
Traceback (most recent call last):
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/train2165.py", line 330, in <module>
    train_model(**arguments)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/train2165.py", line 272, in train_model
    bd_f1, bd_accuracy, bd_precision, bd_recall, bd_auc, bd_y_true, bd_y_pred = generate_bangladesh_sheet(model, grouped_val_samples, excel_dest, six, initial_channels, pneumonia_threshold)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/modules/pneumonia.py", line 182, in generate_bangladesh_sheet
    output = model.predict(np.array([arr]))
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py", line 1629, in predict
    tmp_batch_outputs = self.predict_function(iterator)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 828, in __call__
    result = self._call(*args, **kwds)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 871, in _call
    self._initialize(args, kwds, add_initializers_to=initializers)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 726, in _initialize
    *args, **kwds))
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 2969, in _get_concrete_function_internal_garbage_collected
    graph_function, _ = self._maybe_define_function(args, kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 3361, in _maybe_define_function
    graph_function = self._create_graph_function(args, kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 3206, in _create_graph_function
    capture_by_value=self._capture_by_value),
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/framework/func_graph.py", line 990, in func_graph_from_py_func
    func_outputs = python_func(*func_args, **func_kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 634, in wrapped_fn
    out = weak_wrapped_fn().__wrapped__(*args, **kwds)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/framework/func_graph.py", line 977, in wrapper
    raise e.ag_error_metadata.to_exception(e)
ValueError: in user code:

    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1478 predict_function  *
        return step_function(self, iterator)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1468 step_function  **
        outputs = model.distribute_strategy.run(run_step, args=(data,))
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/distribute/distribute_lib.py:1259 run
        return self._extended.call_for_each_replica(fn, args=args, kwargs=kwargs)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/distribute/distribute_lib.py:2730 call_for_each_replica
        return self._call_for_each_replica(fn, args, kwargs)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/distribute/distribute_lib.py:3417 _call_for_each_replica
        return fn(*args, **kwargs)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1461 run_step  **
        outputs = model.predict_step(data)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1434 predict_step
        return self(x, training=False)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/base_layer.py:998 __call__
        input_spec.assert_input_compatibility(self.input_spec, inputs, self.name)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/input_spec.py:274 assert_input_compatibility
        ', found shape=' + display_shape(x.shape))

    ValueError: Input 0 is incompatible with layer conv2d: expected shape=(None, 1250, 128), found shape=(None, 128, 1250, 1)

wandb: Waiting for W&B process to finish, PID 15936
wandb: Program failed with code 1.  Press ctrl-c to abort syncing.
wandb: - 0.04MB of 0.04MB uploaded (0.00MB deduped)wandb: \ 0.04MB of 0.04MB uploaded (0.00MB deduped)wandb: | 0.04MB of 0.05MB uploaded (0.00MB deduped)wandb: / 0.05MB of 0.05MB uploaded (0.00MB deduped)wandb: - 0.05MB of 0.05MB uploaded (0.00MB deduped)wandb: \ 0.05MB of 0.05MB uploaded (0.00MB deduped)wandb:                                                                                
wandb: Find user logs for this run at: /home/alirachidi/classification_algorithm/trainers/main/wandb/run-20210527_224653-2xp08pho/logs/debug.log
wandb: Find internal logs for this run at: /home/alirachidi/classification_algorithm/trainers/main/wandb/run-20210527_224653-2xp08pho/logs/debug-internal.log
wandb: Run summary:
wandb:       train_accuracy 0.99237
wandb:         val_accuracy 0.68382
wandb:             _runtime 3270
wandb:           _timestamp 1622158884
wandb:                _step 194
wandb:           train_loss 0.10175
wandb:             val_loss 0.81185
wandb:           val_recall 0.22477
wandb:        val_precision 0.21875
wandb:               val_f1 0.22172
wandb:              val_auc 0.22008
wandb:                   lr 0.0
wandb:          best_val_f1 0.33654
wandb:    best_val_accuracy 0.61949
wandb:   best_val_precision 0.25862
wandb:      best_val_recall 0.48165
wandb:             best_auc 0.19027
wandb:           best_epoch 2
wandb: Run history:
wandb:   train_accuracy ▁▂▃▅▆▇█████████████████████
wandb:     val_accuracy ▅▆█▁▂▄▇█▇██████████████████
wandb:         _runtime ▁▁▁▁▁▂▂▂▂▂▃▃▃▃▄▄▄▄▄▄▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇▇████
wandb:       _timestamp ▁▁▁▁▁▂▂▂▂▂▃▃▃▃▄▄▄▄▄▄▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇▇████
wandb:            _step ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:       train_loss ██▇▆▅▃▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:         val_loss ▃▂▁▆█▇▅▆▆▆▆▆▆▆▆▆▇▇▇▆▆▇▇▇▇▇▇
wandb:       val_recall ▅▅▂█▇▅▂▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:    val_precision ▆█▄▁▁▁▄▂▃▃▂▁▃▂▂▂▂▂▂▂▂▂▂▂▂▂▂
wandb:           val_f1 ▇█▃▇▆▅▃▁▃▁▁▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:          val_auc █▁▃▂▃▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂
wandb:               lr ██████▃▃▃▃▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb: 
wandb: Synced 6 W&B file(s), 6 media file(s), 4 artifact file(s) and 0 other file(s)
wandb: 
wandb: Synced train2165: https://wandb.ai/arachid1/tensorboard-integration/runs/2xp08pho


 See logs at ../../new_cache/conv__2165__05_2238__v29__new_lstmdense/logs/