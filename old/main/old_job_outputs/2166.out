Category:  coch
Dataset:  all_sw_coch_preprocessed_v2_param_v29_augm_v0_cleaned_8000.pkl
File:  conv.train2166
Description:  testing_new
2021-05-30 00:57:02.110525: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-05-30 00:57:04.153040: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-05-30 00:57:04.153877: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2021-05-30 00:57:04.166090: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:04.166776: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:00:04.0 name: Tesla T4 computeCapability: 7.5
coreClock: 1.59GHz coreCount: 40 deviceMemorySize: 14.75GiB deviceMemoryBandwidth: 298.08GiB/s
2021-05-30 00:57:04.166801: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-05-30 00:57:04.169929: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-05-30 00:57:04.170005: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-05-30 00:57:04.171049: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-05-30 00:57:04.171338: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-05-30 00:57:04.172459: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-05-30 00:57:04.173353: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-05-30 00:57:04.173499: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-05-30 00:57:04.173602: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:04.174320: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:04.174960: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
wandb: Currently logged in as: arachid1 (use `wandb login --relogin` to force relogin)
Tensorflow Version: 2.4.0
Num GPUs Available:  1
-----------------------
Using module located at /main/models/conv/train2166.py
Using train_file located at ../../data/datasets/all_sw_coch_preprocessed_v2_param_v29_augm_v0_cleaned_8000.pkl
Using logs_path located at ../../new_cache/conv__2166__05_0056__v29__testing_new/logs/
-----------------------
Collecting Variables...
Model Parameters: {'N_CLASSES': 1, 'SR': 8000, 'BATCH_SIZE': 16, 'LR': 0.001, 'SHAPE': (1250, 128, 1), 'WEIGHT_DECAY': 0.001, 'LL2_REG': 0, 'EPSILON': 1e-07, 'LABEL_SMOOTHING': 0}
Learning Rate Parameters: {'factor': 0.25, 'patience': 4, 'min_lr': 1e-10}
Early Stopping Patience and Delta: 25, 0%
Six: False and Concat: False
-----------------------
wandb: wandb version 0.10.31 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.10.30
wandb: Syncing run train2166
wandb: ⭐️ View project at https://wandb.ai/arachid1/tensorboard-integration
wandb: 🚀 View run at https://wandb.ai/arachid1/tensorboard-integration/runs/il4xs56o
wandb: Run data is saved locally in /home/alirachidi/classification_algorithm/trainers/main/wandb/run-20210530_005704-il4xs56o
wandb: Run `wandb offline` to turn off syncing.
2021-05-30 00:57:08.853268: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-05-30 00:57:08.853503: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:08.854296: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:00:04.0 name: Tesla T4 computeCapability: 7.5
coreClock: 1.59GHz coreCount: 40 deviceMemorySize: 14.75GiB deviceMemoryBandwidth: 298.08GiB/s
2021-05-30 00:57:08.854338: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-05-30 00:57:08.854387: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-05-30 00:57:08.854408: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-05-30 00:57:08.854429: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2021-05-30 00:57:08.854450: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2021-05-30 00:57:08.854471: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2021-05-30 00:57:08.854492: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2021-05-30 00:57:08.854511: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2021-05-30 00:57:08.854606: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:08.855400: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:08.856103: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2021-05-30 00:57:08.856150: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2021-05-30 00:57:09.558763: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2021-05-30 00:57:09.558804: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2021-05-30 00:57:09.558823: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2021-05-30 00:57:09.559100: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:09.559863: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:09.560604: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:941] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2021-05-30 00:57:09.561286: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 13968 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:00:04.0, compute capability: 7.5)
2021-05-30 00:57:43.731545: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:116] None of the MLIR optimization passes are enabled (registered 2)
2021-05-30 00:57:43.732931: I tensorflow/core/platform/profile_utils/cpu_utils.cc:112] CPU Frequency: 2299995000 Hz
2021-05-30 00:57:47.058560: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2021-05-30 00:57:47.721964: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2021-05-30 00:57:47.729213: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8

Original number of folders: 453
With concat = False and six = False, size of training set: 4196...
...and size of validation set: 1088
Initializing weights...
weights = {0: 0.7018518518518518, 1: 1.738532110091743}
Model: "conv2d"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input_1 (InputLayer)         [(None, 1250, 128, 1)]    0         
_________________________________________________________________
conv2d (Conv2D)              (None, 1250, 128, 8)      80        
_________________________________________________________________
mix_depth_group_convolution2 (None, 1250, 128, 8)      162       
_________________________________________________________________
average_pooling2d (AveragePo (None, 1250, 64, 8)       0         
_________________________________________________________________
batch_normalization (BatchNo (None, 1250, 64, 8)       32        
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 1250, 64, 16)      1168      
_________________________________________________________________
mix_depth_group_convolution2 (None, 1250, 64, 16)      414       
_________________________________________________________________
average_pooling2d_1 (Average (None, 1250, 32, 16)      0         
_________________________________________________________________
batch_normalization_1 (Batch (None, 1250, 32, 16)      64        
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 1250, 32, 32)      4640      
_________________________________________________________________
mix_depth_group_convolution2 (None, 1250, 32, 32)      828       
_________________________________________________________________
average_pooling2d_2 (Average (None, 1250, 16, 32)      0         
_________________________________________________________________
batch_normalization_2 (Batch (None, 1250, 16, 32)      128       
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 1250, 16, 64)      18496     
_________________________________________________________________
mix_depth_group_convolution2 (None, 1250, 16, 64)      1656      
_________________________________________________________________
average_pooling2d_3 (Average (None, 1250, 8, 64)       0         
_________________________________________________________________
batch_normalization_3 (Batch (None, 1250, 8, 64)       256       
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 1250, 8, 128)      73856     
_________________________________________________________________
mix_depth_group_convolution2 (None, 1250, 8, 128)      3402      
_________________________________________________________________
average_pooling2d_4 (Average (None, 1250, 1, 128)      0         
_________________________________________________________________
batch_normalization_4 (Batch (None, 1250, 1, 128)      512       
_________________________________________________________________
reshape (Reshape)            (None, 1250, 128)         0         
_________________________________________________________________
bidirectional (Bidirectional (None, 256)               263168    
_________________________________________________________________
dense (Dense)                (None, 1)                 257       
=================================================================
Total params: 369,119
Trainable params: 368,623
Non-trainable params: 496
_________________________________________________________________
Epoch 1/80
263/263 - 339s - loss: 0.6964 - accuracy: 0.5443 - val_loss: 0.6552 - val_accuracy: 0.7996
Confusion matrix: 
 [[870   0]
 [218   0]]
Validation f1: 0.00
Validation accuracy: 79.96
/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/sklearn/metrics/_classification.py:1272: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 due to no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
Validation recall: 0.00
Validation precision: 0.00
Validation AUC: 0.22081214060991677
Validation class accuracies: [1.0, 0.0]
TARGET: 1
target metric(test f1): 0.0
inside not defaulting
The validation tracker metric at 0 hasn't increased by 0 in 1 epochs
Epoch 2/80
263/263 - 330s - loss: 0.6839 - accuracy: 0.5867 - val_loss: 0.6710 - val_accuracy: 0.7877
Confusion matrix: 
 [[852  18]
 [213   5]]
Validation f1: 4.15
Validation accuracy: 78.77
Validation recall: 2.29
Validation precision: 21.74
Validation AUC: 0.22058293505204452
Validation class accuracies: [0.9793103448275862, 0.022935779816513763]
TARGET: 1
target metric(test f1): 0.04149377593360996
inside not defaulting
Saving model...
Epoch 3/80
263/263 - 328s - loss: 0.6777 - accuracy: 0.5729 - val_loss: 0.6611 - val_accuracy: 0.6397
Confusion matrix: 
 [[643 227]
 [165  53]]
Validation f1: 21.29
Validation accuracy: 63.97
Validation recall: 24.31
Validation precision: 18.93
Validation AUC: 0.20969873064556854
Validation class accuracies: [0.7390804597701149, 0.24311926605504589]
TARGET: 1
target metric(test f1): 0.21285140562248997
inside not defaulting
Saving model...
Epoch 4/80
263/263 - 327s - loss: 0.6697 - accuracy: 0.6058 - val_loss: 0.6372 - val_accuracy: 0.6829
Confusion matrix: 
 [[704 166]
 [179  39]]
Validation f1: 18.44
Validation accuracy: 68.29
Validation recall: 17.89
Validation precision: 19.02
Validation AUC: 0.19859183436457314
Validation class accuracies: [0.8091954022988506, 0.17889908256880735]
TARGET: 1
target metric(test f1): 0.18439716312056742
inside not defaulting
The validation tracker metric at 0.21285140562248997 hasn't increased by 0 in 1 epochs
Epoch 5/80
263/263 - 327s - loss: 0.6509 - accuracy: 0.6385 - val_loss: 0.7295 - val_accuracy: 0.4926
Confusion matrix: 
 [[413 457]
 [ 95 123]]
Validation f1: 30.83
Validation accuracy: 49.26
Validation recall: 56.42
Validation precision: 21.21
Validation AUC: 0.20931513342297908
Validation class accuracies: [0.4747126436781609, 0.5642201834862385]
TARGET: 1
target metric(test f1): 0.3082706766917293
inside not defaulting
Saving model...
Epoch 6/80
263/263 - 328s - loss: 0.6076 - accuracy: 0.6892 - val_loss: 0.7951 - val_accuracy: 0.4458
Confusion matrix: 
 [[359 511]
 [ 92 126]]
Validation f1: 29.47
Validation accuracy: 44.58
Validation recall: 57.80
Validation precision: 19.78
Validation AUC: 0.2022792066165724
Validation class accuracies: [0.4126436781609195, 0.5779816513761468]
TARGET: 1
target metric(test f1): 0.2947368421052632
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 1 epochs
Epoch 7/80
263/263 - 326s - loss: 0.5185 - accuracy: 0.7619 - val_loss: 0.7426 - val_accuracy: 0.5892
Confusion matrix: 
 [[563 307]
 [140  78]]
Validation f1: 25.87
Validation accuracy: 58.92
Validation recall: 35.78
Validation precision: 20.26
Validation AUC: 0.2042451988408422
Validation class accuracies: [0.6471264367816092, 0.3577981651376147]
TARGET: 1
target metric(test f1): 0.2587064676616916
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 2 epochs
Epoch 8/80
263/263 - 327s - loss: 0.3780 - accuracy: 0.8458 - val_loss: 0.7634 - val_accuracy: 0.6471
Confusion matrix: 
 [[652 218]
 [166  52]]
Validation f1: 21.31
Validation accuracy: 64.71
Validation recall: 23.85
Validation precision: 19.26
Validation AUC: 0.19563923970318287
Validation class accuracies: [0.7494252873563219, 0.23853211009174313]
TARGET: 1
target metric(test f1): 0.21311475409836067
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 3 epochs
Epoch 9/80
263/263 - 330s - loss: 0.2557 - accuracy: 0.9020 - val_loss: 0.8243 - val_accuracy: 0.6774
Confusion matrix: 
 [[683 187]
 [164  54]]
Validation f1: 23.53
Validation accuracy: 67.74
Validation recall: 24.77
Validation precision: 22.41
Validation AUC: 0.21331495774691264
Validation class accuracies: [0.7850574712643679, 0.24770642201834864]
TARGET: 1
target metric(test f1): 0.23529411764705882
inside not defaulting
Lr has been adjusted to 0.0002500000118743628
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 4 epochs
Epoch 10/80
263/263 - 334s - loss: 0.1342 - accuracy: 0.9607 - val_loss: 1.0075 - val_accuracy: 0.6324
Confusion matrix: 
 [[631 239]
 [161  57]]
Validation f1: 22.18
Validation accuracy: 63.24
Validation recall: 26.15
Validation precision: 19.26
Validation AUC: 0.19551766710673904
Validation class accuracies: [0.725287356321839, 0.26146788990825687]
TARGET: 1
target metric(test f1): 0.2217898832684825
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 5 epochs
Epoch 11/80
263/263 - 326s - loss: 0.0816 - accuracy: 0.9786 - val_loss: 1.0932 - val_accuracy: 0.6425
Confusion matrix: 
 [[649 221]
 [168  50]]
Validation f1: 20.45
Validation accuracy: 64.25
Validation recall: 22.94
Validation precision: 18.45
Validation AUC: 0.19292173152805048
Validation class accuracies: [0.7459770114942529, 0.22935779816513763]
TARGET: 1
target metric(test f1): 0.20449897750511248
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 6 epochs
Epoch 12/80
263/263 - 327s - loss: 0.0632 - accuracy: 0.9836 - val_loss: 1.1142 - val_accuracy: 0.6590
Confusion matrix: 
 [[672 198]
 [173  45]]
Validation f1: 19.52
Validation accuracy: 65.90
Validation recall: 20.64
Validation precision: 18.52
Validation AUC: 0.19508301170216819
Validation class accuracies: [0.7724137931034483, 0.20642201834862386]
TARGET: 1
target metric(test f1): 0.1952277657266811
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 7 epochs
Epoch 13/80
263/263 - 331s - loss: 0.0534 - accuracy: 0.9852 - val_loss: 1.1634 - val_accuracy: 0.6590
Confusion matrix: 
 [[670 200]
 [171  47]]
Validation f1: 20.22
Validation accuracy: 65.90
Validation recall: 21.56
Validation precision: 19.03
Validation AUC: 0.19794274948260027
Validation class accuracies: [0.7701149425287356, 0.21559633027522937]
TARGET: 1
target metric(test f1): 0.2021505376344086
inside not defaulting
Lr has been adjusted to 6.25000029685907e-05
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 8 epochs
Epoch 14/80
263/263 - 327s - loss: 0.0393 - accuracy: 0.9895 - val_loss: 1.1703 - val_accuracy: 0.6590
Confusion matrix: 
 [[671 199]
 [172  46]]
Validation f1: 19.87
Validation accuracy: 65.90
Validation recall: 21.10
Validation precision: 18.78
Validation AUC: 0.1975506313948999
Validation class accuracies: [0.771264367816092, 0.21100917431192662]
TARGET: 1
target metric(test f1): 0.1987041036717063
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 9 epochs
Epoch 15/80
263/263 - 330s - loss: 0.0349 - accuracy: 0.9933 - val_loss: 1.1837 - val_accuracy: 0.6599
Confusion matrix: 
 [[672 198]
 [172  46]]
Validation f1: 19.91
Validation accuracy: 65.99
Validation recall: 21.10
Validation precision: 18.85
Validation AUC: 0.19829811687711918
Validation class accuracies: [0.7724137931034483, 0.21100917431192662]
TARGET: 1
target metric(test f1): 0.1991341991341991
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 10 epochs
Epoch 16/80
263/263 - 333s - loss: 0.0321 - accuracy: 0.9948 - val_loss: 1.2047 - val_accuracy: 0.6608
Confusion matrix: 
 [[673 197]
 [172  46]]
Validation f1: 19.96
Validation accuracy: 66.08
Validation recall: 21.10
Validation precision: 18.93
Validation AUC: 0.19919741981370667
Validation class accuracies: [0.7735632183908046, 0.21100917431192662]
TARGET: 1
target metric(test f1): 0.19956616052060738
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 11 epochs
Epoch 17/80
263/263 - 332s - loss: 0.0340 - accuracy: 0.9924 - val_loss: 1.2125 - val_accuracy: 0.6627
Confusion matrix: 
 [[675 195]
 [172  46]]
Validation f1: 20.04
Validation accuracy: 66.27
Validation recall: 21.10
Validation precision: 19.09
Validation AUC: 0.19906151682304402
Validation class accuracies: [0.7758620689655172, 0.21100917431192662]
TARGET: 1
target metric(test f1): 0.20043572984749455
inside not defaulting
Lr has been adjusted to 1.5625000742147677e-05
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 12 epochs
Epoch 18/80
263/263 - 331s - loss: 0.0291 - accuracy: 0.9938 - val_loss: 1.2117 - val_accuracy: 0.6636
Confusion matrix: 
 [[679 191]
 [175  43]]
Validation f1: 19.03
Validation accuracy: 66.36
Validation recall: 19.72
Validation precision: 18.38
Validation AUC: 0.1986705156925198
Validation class accuracies: [0.7804597701149425, 0.19724770642201836]
TARGET: 1
target metric(test f1): 0.19026548672566373
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 13 epochs
Epoch 19/80
263/263 - 328s - loss: 0.0315 - accuracy: 0.9921 - val_loss: 1.2109 - val_accuracy: 0.6664
Confusion matrix: 
 [[682 188]
 [175  43]]
Validation f1: 19.15
Validation accuracy: 66.64
Validation recall: 19.72
Validation precision: 18.61
Validation AUC: 0.1988736267869291
Validation class accuracies: [0.7839080459770115, 0.19724770642201836]
TARGET: 1
target metric(test f1): 0.19153674832962136
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 14 epochs
Epoch 20/80
263/263 - 327s - loss: 0.0353 - accuracy: 0.9917 - val_loss: 1.2255 - val_accuracy: 0.6590
Confusion matrix: 
 [[671 199]
 [172  46]]
Validation f1: 19.87
Validation accuracy: 65.90
Validation recall: 21.10
Validation precision: 18.78
Validation AUC: 0.19951379963001997
Validation class accuracies: [0.771264367816092, 0.21100917431192662]
TARGET: 1
target metric(test f1): 0.1987041036717063
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 15 epochs
Epoch 21/80
263/263 - 330s - loss: 0.0312 - accuracy: 0.9931 - val_loss: 1.2249 - val_accuracy: 0.6599
Confusion matrix: 
 [[674 196]
 [174  44]]
Validation f1: 19.21
Validation accuracy: 65.99
Validation recall: 20.18
Validation precision: 18.33
Validation AUC: 0.19932204115270047
Validation class accuracies: [0.774712643678161, 0.2018348623853211]
TARGET: 1
target metric(test f1): 0.19213973799126635
inside not defaulting
Lr has been adjusted to 3.906250185536919e-06
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 16 epochs
Epoch 22/80
263/263 - 334s - loss: 0.0321 - accuracy: 0.9933 - val_loss: 1.2263 - val_accuracy: 0.6618
Confusion matrix: 
 [[674 196]
 [172  46]]
Validation f1: 20.00
Validation accuracy: 66.18
Validation recall: 21.10
Validation precision: 19.01
Validation AUC: 0.19958619206964226
Validation class accuracies: [0.774712643678161, 0.21100917431192662]
TARGET: 1
target metric(test f1): 0.2
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 17 epochs
Epoch 23/80
263/263 - 329s - loss: 0.0311 - accuracy: 0.9929 - val_loss: 1.2250 - val_accuracy: 0.6599
Confusion matrix: 
 [[674 196]
 [174  44]]
Validation f1: 19.21
Validation accuracy: 65.99
Validation recall: 20.18
Validation precision: 18.33
Validation AUC: 0.19908031970506673
Validation class accuracies: [0.774712643678161, 0.2018348623853211]
TARGET: 1
target metric(test f1): 0.19213973799126635
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 18 epochs
Epoch 24/80
263/263 - 327s - loss: 0.0278 - accuracy: 0.9952 - val_loss: 1.2243 - val_accuracy: 0.6590
Confusion matrix: 
 [[674 196]
 [175  43]]
Validation f1: 18.82
Validation accuracy: 65.90
Validation recall: 19.72
Validation precision: 17.99
Validation AUC: 0.19911159982727916
Validation class accuracies: [0.774712643678161, 0.19724770642201836]
TARGET: 1
target metric(test f1): 0.18818380743982493
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 19 epochs
Epoch 25/80
263/263 - 332s - loss: 0.0333 - accuracy: 0.9943 - val_loss: 1.2241 - val_accuracy: 0.6618
Confusion matrix: 
 [[675 195]
 [173  45]]
Validation f1: 19.65
Validation accuracy: 66.18
Validation recall: 20.64
Validation precision: 18.75
Validation AUC: 0.1993904865170945
Validation class accuracies: [0.7758620689655172, 0.20642201834862386]
TARGET: 1
target metric(test f1): 0.19650655021834063
inside not defaulting
Lr has been adjusted to 9.765625463842298e-07
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 20 epochs
Epoch 26/80
263/263 - 331s - loss: 0.0308 - accuracy: 0.9917 - val_loss: 1.2248 - val_accuracy: 0.6645
Confusion matrix: 
 [[677 193]
 [172  46]]
Validation f1: 20.13
Validation accuracy: 66.45
Validation recall: 21.10
Validation precision: 19.25
Validation AUC: 0.19975531625988494
Validation class accuracies: [0.7781609195402299, 0.21100917431192662]
TARGET: 1
target metric(test f1): 0.2013129102844639
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 21 epochs
Epoch 27/80
263/263 - 331s - loss: 0.0316 - accuracy: 0.9948 - val_loss: 1.2239 - val_accuracy: 0.6608
Confusion matrix: 
 [[675 195]
 [174  44]]
Validation f1: 19.26
Validation accuracy: 66.08
Validation recall: 20.18
Validation precision: 18.41
Validation AUC: 0.19900971083547833
Validation class accuracies: [0.7758620689655172, 0.2018348623853211]
TARGET: 1
target metric(test f1): 0.19256017505470457
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 22 epochs
Epoch 28/80
263/263 - 331s - loss: 0.0278 - accuracy: 0.9945 - val_loss: 1.2249 - val_accuracy: 0.6608
Confusion matrix: 
 [[673 197]
 [172  46]]
Validation f1: 19.96
Validation accuracy: 66.08
Validation recall: 21.10
Validation precision: 18.93
Validation AUC: 0.19971026391181312
Validation class accuracies: [0.7735632183908046, 0.21100917431192662]
TARGET: 1
target metric(test f1): 0.19956616052060738
inside not defaulting
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 23 epochs
Epoch 29/80
263/263 - 331s - loss: 0.0282 - accuracy: 0.9938 - val_loss: 1.2236 - val_accuracy: 0.6599
Confusion matrix: 
 [[674 196]
 [174  44]]
Validation f1: 19.21
Validation accuracy: 65.99
Validation recall: 20.18
Validation precision: 18.33
Validation AUC: 0.19900129959033372
Validation class accuracies: [0.774712643678161, 0.2018348623853211]
TARGET: 1
target metric(test f1): 0.19213973799126635
inside not defaulting
Lr has been adjusted to 2.4414063659605745e-07
The validation tracker metric at 0.3082706766917293 hasn't increased by 0 in 24 epochs
Epoch 30/80
263/263 - 331s - loss: 0.0295 - accuracy: 0.9931 - val_loss: 1.2250 - val_accuracy: 0.6618
Confusion matrix: 
 [[675 195]
 [173  45]]
Validation f1: 19.65
Validation accuracy: 66.18
Validation recall: 20.64
Validation precision: 18.75
Validation AUC: 0.19936631641949787
Validation class accuracies: [0.7758620689655172, 0.20642201834862386]

The metrics for the epoch with the best target metric are: 
Best cm: [[413 457]
 [ 95 123]]
Best f1: 0.3082706766917293
Best accuracy: 0.49264705882352944
Best recall: 0.5642201834862385
Best precision: 0.2120689655172414
Best AUC: 0.20931513342297908
Best epoch: 5
TARGET: 1
target metric(test f1): 0.19650655021834063
inside not defaulting
The number of epochs since last 1% equals the patience

Starting the Bangladesh analysis...
Epoch: 80
Starting...
Traceback (most recent call last):
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/runpy.py", line 193, in _run_module_as_main
    "__main__", mod_spec)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/runpy.py", line 85, in _run_code
    exec(code, run_globals)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/train2166.py", line 329, in <module>
    train_model(**arguments)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/train2166.py", line 271, in train_model
    bd_f1, bd_accuracy, bd_precision, bd_recall, bd_auc, bd_y_true, bd_y_pred = generate_bangladesh_sheet(model, grouped_val_samples, excel_dest, six, initial_channels, pneumonia_threshold)
  File "/home/alirachidi/classification_algorithm/trainers/main/models/conv/modules/pneumonia.py", line 182, in generate_bangladesh_sheet
    output = model.predict(np.array([arr]))
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py", line 1629, in predict
    tmp_batch_outputs = self.predict_function(iterator)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 828, in __call__
    result = self._call(*args, **kwds)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 871, in _call
    self._initialize(args, kwds, add_initializers_to=initializers)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 726, in _initialize
    *args, **kwds))
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 2969, in _get_concrete_function_internal_garbage_collected
    graph_function, _ = self._maybe_define_function(args, kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 3361, in _maybe_define_function
    graph_function = self._create_graph_function(args, kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 3206, in _create_graph_function
    capture_by_value=self._capture_by_value),
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/framework/func_graph.py", line 990, in func_graph_from_py_func
    func_outputs = python_func(*func_args, **func_kwargs)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 634, in wrapped_fn
    out = weak_wrapped_fn().__wrapped__(*args, **kwds)
  File "/home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/framework/func_graph.py", line 977, in wrapper
    raise e.ag_error_metadata.to_exception(e)
ValueError: in user code:

    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1478 predict_function  *
        return step_function(self, iterator)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1468 step_function  **
        outputs = model.distribute_strategy.run(run_step, args=(data,))
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/distribute/distribute_lib.py:1259 run
        return self._extended.call_for_each_replica(fn, args=args, kwargs=kwargs)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/distribute/distribute_lib.py:2730 call_for_each_replica
        return self._call_for_each_replica(fn, args, kwargs)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/distribute/distribute_lib.py:3417 _call_for_each_replica
        return fn(*args, **kwargs)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1461 run_step  **
        outputs = model.predict_step(data)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1434 predict_step
        return self(x, training=False)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/base_layer.py:998 __call__
        input_spec.assert_input_compatibility(self.input_spec, inputs, self.name)
    /home/alirachidi/anaconda3/envs/LungSoundClass/lib/python3.7/site-packages/tensorflow/python/keras/engine/input_spec.py:274 assert_input_compatibility
        ', found shape=' + display_shape(x.shape))

    ValueError: Input 0 is incompatible with layer conv2d: expected shape=(None, 1250, 128, 1), found shape=(None, 128, 1250, 1)

wandb: Waiting for W&B process to finish, PID 11828
wandb: Program failed with code 1.  Press ctrl-c to abort syncing.
wandb: - 0.06MB of 0.06MB uploaded (0.00MB deduped)wandb: \ 0.06MB of 0.06MB uploaded (0.00MB deduped)wandb: | 0.06MB of 0.08MB uploaded (0.00MB deduped)wandb: / 0.08MB of 0.08MB uploaded (0.00MB deduped)wandb: - 0.08MB of 0.08MB uploaded (0.00MB deduped)wandb: \ 0.08MB of 0.08MB uploaded (0.00MB deduped)wandb: | 0.08MB of 0.08MB uploaded (0.00MB deduped)wandb: / 0.08MB of 0.08MB uploaded (0.00MB deduped)wandb:                                                                                
wandb: Find user logs for this run at: /home/alirachidi/classification_algorithm/trainers/main/wandb/run-20210530_005704-il4xs56o/logs/debug.log
wandb: Find internal logs for this run at: /home/alirachidi/classification_algorithm/trainers/main/wandb/run-20210530_005704-il4xs56o/logs/debug-internal.log
wandb: Run summary:
wandb:       train_accuracy 0.99309
wandb:         val_accuracy 0.66176
wandb:             _runtime 10464
wandb:           _timestamp 1622346688
wandb:                _step 218
wandb:           train_loss 0.02953
wandb:             val_loss 1.22499
wandb:           val_recall 0.20642
wandb:        val_precision 0.1875
wandb:               val_f1 0.19651
wandb:              val_auc 0.19937
wandb:                   lr 0.0
wandb:          best_val_f1 0.30827
wandb:    best_val_accuracy 0.49265
wandb:   best_val_precision 0.21207
wandb:      best_val_recall 0.56422
wandb:             best_auc 0.20932
wandb:           best_epoch 5
wandb: Run history:
wandb:   train_accuracy ▁▂▁▂▂▃▄▆▇▇████████████████████
wandb:     val_accuracy ██▅▆▂▁▄▅▆▅▅▅▅▅▅▅▅▅▅▅▅▅▅▅▅▅▅▅▅▅
wandb:         _runtime ▁▁▁▁▁▂▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇████
wandb:       _timestamp ▁▁▁▁▁▂▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇████
wandb:            _step ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:       train_loss █████▇▆▅▃▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:         val_loss ▁▁▁▁▂▃▂▂▃▅▆▇▇▇▇███████████████
wandb:       val_recall ▁▁▄▃██▅▄▄▄▄▃▄▄▄▄▄▃▃▄▃▄▃▃▃▄▃▄▃▃
wandb:    val_precision ▁█▇▇█▇▇▇█▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇▇
wandb:           val_f1 ▁▂▆▅██▇▆▆▆▆▅▆▆▆▆▆▅▅▆▅▆▅▅▅▆▅▆▅▅
wandb:          val_auc ██▅▂▅▃▄▂▆▂▁▂▂▂▂▃▃▂▂▃▃▃▃▃▃▃▃▃▃▃
wandb:               lr █████████▃▃▃▃▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb: 
wandb: Synced 6 W&B file(s), 9 media file(s), 6 artifact file(s) and 0 other file(s)
wandb: 
wandb: Synced train2166: https://wandb.ai/arachid1/tensorboard-integration/runs/il4xs56o


 See logs at ../../new_cache/conv__2166__05_0056__v29__testing_new/logs/